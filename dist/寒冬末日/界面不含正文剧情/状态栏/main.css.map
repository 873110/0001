{"version":3,"file":"main.css","mappings":"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A,UACE,kBAAmB,CACnB,YAAa,CACb,+BAAgC,CAChC,kBAAmB,CACnB,uCACF,CAEA,YACE,gBAAiB,CACjB,wBAAyB,CACzB,kBAAmB,CACnB,gBAAiB,CACjB,YAAa,CACb,kBAAmB,CACnB,OACF,CAEA,iBACE,iBAAkB,CAClB,eAAgB,CAChB,uBAAwB,CACxB,WAAY,CACZ,YAAa,CACb,WAAY,CACZ,2CAA+C,CAC/C,8CACF,CAEA,WACE,YAAa,CACb,OACF,CAEA,eACE,mCACF,CAEA,WACE,mCACF,CAEA,YACE,mCACF,CAEA,gBACE,YAAa,CACb,mCAAqC,CACrC,OACF,CAEA,WACE,iCAAkC,CAClC,eAAgB,CAChB,iBAAkB,CAClB,iBAAkB,CAClB,uCAA2C,CAC3C,sCAAuC,CACvC,eAAgB,CAChB,YAAa,CACb,qBAAsB,CACtB,sBACF,CAEA,iBACE,gCAAiC,CACjC,wCACF,CAEA,qBACE,gCAAiC,CACjC,gCAAiC,CACjC,0CACF,CAEA,qBACE,+BAAgC,CAChC,sCACF,CAEA,kCACE,wBACF,CAEA,oBACE,gCAAiC,CACjC,sCACF,CAEA,gCACE,yBACF,CAEA,aACE,eAAgB,CAChB,gBAAiB,CACjB,wBAAyB,CACzB,iBACF,CAEA,YACE,gBAAiB,CACjB,wBAAyB,CACzB,iBAAkB,CAClB,kBAAmB,CACnB,eAAgB,CAChB,sBACF,CAEA,eACE,eAAgB,CAChB,uBAAwB,CACxB,WAAY,CACZ,kBAAmB,CACnB,eAAgB,CAChB,sBACF,CAEA,gBACE,iCAAkC,CAClC,gBAAiB,CACjB,iBAAkB,CAClB,iBAAkB,CAClB,uCAA2C,CAC3C,WAAY,CACZ,sCACF,CAEA,yBACE,SAAU,CACV,kBAAmB,CACnB,gCAAiC,CACjC,gCACF,CAEA,gBACE,eAAgB,CAChB,iBACF,CAEA,gBACE,gBAAiB,CACjB,gBAAiB,CACjB,uBAAwB,CACxB,iBACF,CAEA,kBACE,eAAgB,CAChB,uBACF,CAEA,2CACE,yBACF,CAGA,yBACE,eACE,mCACF,CAEA,WACE,mCACF,CAEA,YACE,mCACF,CAEA,gBACE,mCACF,CAEA,WACE,eAAgB,CAChB,eACF,CAEA,aACE,gBACF,CAEA,eACE,gBACF,CACF,CAEA,yBACE,YACE,mCACF,CAEA,gBACE,mCACF,CACF","sources":["src://tavern_helper_template/src/ÂØíÂÜ¨Êú´Êó•/ÁïåÈù¢‰∏çÂê´Ê≠£ÊñáÂâßÊÉÖ/Áä∂ÊÄÅÊ†è/components/CharactersSection.vue","src://tavern_helper_template/src/ÂØíÂÜ¨Êú´Êó•/ÁïåÈù¢‰∏çÂê´Ê≠£ÊñáÂâßÊÉÖ/Áä∂ÊÄÅÊ†è/components/ChoicesSection.vue","src://tavern_helper_template/src/ÂØíÂÜ¨Êú´Êó•/ÁïåÈù¢‰∏çÂê´Ê≠£ÊñáÂâßÊÉÖ/Áä∂ÊÄÅÊ†è/components/MissionSection.vue","src://tavern_helper_template/src/ÂØíÂÜ¨Êú´Êó•/ÁïåÈù¢‰∏çÂê´Ê≠£ÊñáÂâßÊÉÖ/Áä∂ÊÄÅÊ†è/components/ShelterSection.vue","src://tavern_helper_template/src/ÂØíÂÜ¨Êú´Êó•/ÁïåÈù¢‰∏çÂê´Ê≠£ÊñáÂâßÊÉÖ/Áä∂ÊÄÅÊ†è/global.css"],"sourcesContent":["<template>\n  <section id=\"characters-section\" class=\"section\">\n    <h2 class=\"section-title\">üë§ ÁôªÂú∫ËßíËâ≤ üë§</h2>\n    <div class=\"status-tabs-container\">\n      <template v-if=\"active_character_keys.length > 0\">\n        <div class=\"tab-buttons\">\n          <button\n            v-for=\"key in active_character_keys\"\n            :key=\"key\"\n            class=\"tab-button\"\n            :class=\"{ active: active_character_key === key }\"\n            type=\"button\"\n            @click=\"setActiveCharacter(key)\"\n          >\n            {{ getCharacterDisplayName(key) }}\n            <span class=\"status-pill\" :class=\"getCharacterStatus(key)\">{{ getCharacterStatus(key) }}</span>\n          </button>\n        </div>\n\n        <div\n          v-for=\"key in active_character_keys\"\n          v-show=\"active_character_key === key\"\n          :key=\"`${key}:tab`\"\n          class=\"tab-content\"\n          :class=\"{ active: active_character_key === key }\"\n        >\n          <div class=\"status-grid\">\n            <div class=\"status-item health-section\">\n              <div class=\"health-section-header\">\n                <div class=\"label\">‚ù§Ô∏è ÂÅ•Â∫∑</div>\n                <div class=\"value\">\n                  {{ getCharacter(key)?.ÂÅ•Â∫∑ ?? '--' }}\n                  <button\n                    v-if=\"canDeleteRole(key)\"\n                    class=\"role-remove-btn\"\n                    type=\"button\"\n                    aria-label=\"Âà†Èô§ËßíËâ≤\"\n                    :disabled=\"deletingRoleName === getRoleNameKey(key)\"\n                    @click=\"onClickDeleteRole(key)\"\n                  >\n                    √ó\n                  </button>\n                </div>\n              </div>\n              <div class=\"health-status-subtext\">{{ getCharacter(key)?.ÂÅ•Â∫∑Áä∂ÂÜµ ?? '--' }}</div>\n              <div class=\"progress-bar-container\">\n                <div class=\"progress-bar-value\" :style=\"{ width: `${healthPercent(key)}%` }\"></div>\n              </div>\n              <div class=\"value-subtext\">{{ getCharacterChange(key) }}</div>\n            </div>\n\n            <div class=\"status-item imprint-section\">\n              <div class=\"health-section-header\">\n                <div class=\"label\">üî± Áß©Â∫èÂàªÂç∞</div>\n                <div class=\"value\">{{ getCharacter(key)?.Áß©Â∫èÂàªÂç∞ ?? '--' }}</div>\n              </div>\n              <div class=\"imprint-status-subtext\">\n                {{ getRelationStage(key) }} ¬∑ ÂÖ≥Á≥ªÂÄæÂêëÔºö{{ getRelationTendency(key) }}\n              </div>\n              <div class=\"progress-bar-container imprint-bar\">\n                <div class=\"progress-bar-value\" :style=\"{ width: `${imprintPercent(key)}%` }\"></div>\n              </div>\n              <div class=\"value-subtext imprint-change\">\n                {{ getImprintChange(key) || ' ' }}\n              </div>\n              <div class=\"value-subtext imprint-hint\">\n                Âå∫Èó¥Ôºö{{ getRelationRangeText(key) }}ÔΩúÊï∞ÂÄºË∂äÈ´òË°®Á§∫Êõ¥Ê∑±ÁöÑÁß©Â∫èÁªëÂÆö\n              </div>\n            </div>\n\n            <div class=\"details-grid\">\n              <div class=\"status-item\">\n                <div class=\"label\">üëö Ë°£ÁùÄ</div>\n                <div class=\"value\">{{ getCharacter(key)?.Ë°£ÁùÄ ?? '--' }}</div>\n              </div>\n              <div class=\"status-item\">\n                <div class=\"label\">üëÖ ËàåÂîá</div>\n                <div class=\"value\">{{ getCharacter(key)?.ËàåÂîá ?? '--' }}</div>\n              </div>\n              <div class=\"status-item\">\n                <div class=\"label\">üçà ËÉ∏‰π≥</div>\n                <div class=\"value\">{{ getCharacter(key)?.ËÉ∏‰π≥ ?? '--' }}</div>\n              </div>\n              <div class=\"status-item\">\n                <div class=\"label\">üå∏ ÁßÅÁ©¥</div>\n                <div class=\"value\">{{ getCharacter(key)?.ÁßÅÁ©¥ ?? '--' }}</div>\n              </div>\n              <div class=\"status-item\">\n                <div class=\"label\">üòä Á•ûÊÄÅÊ†∑Ë≤å</div>\n                <div class=\"value\">{{ getCharacter(key)?.Á•ûÊÄÅÊ†∑Ë≤å ?? '--' }}</div>\n              </div>\n              <div class=\"status-item\">\n                <div class=\"label\">üíÉ Âä®‰ΩúÂßøÂäø</div>\n                <div class=\"value\">{{ getCharacter(key)?.Âä®‰ΩúÂßøÂäø ?? '--' }}</div>\n              </div>\n            </div>\n\n            <div class=\"status-item\">\n              <div class=\"label\">üí≠ ÂÜÖÂøÉÊÉ≥Ê≥ï</div>\n              <div class=\"value thought-text\">{{ getCharacter(key)?.ÂÜÖÂøÉÊÉ≥Ê≥ï ?? '--' }}</div>\n            </div>\n          </div>\n        </div>\n      </template>\n\n      <template v-else>\n        <div class=\"content-text\">ÊöÇÊó†ÁôªÂú∫ËßíËâ≤</div>\n      </template>\n    </div>\n  </section>\n</template>\n\n<script setup lang=\"ts\">\nimport _ from 'lodash';\nimport type { Schema as SchemaType } from '../../../schema';\nimport { useDataStore } from '../../store';\n\n// Êâ©Â±ï CharacterKey ‰ª•ÂåÖÂê´‰∏¥Êó∂ NPC ÁöÑ key (Ê†ºÂºè: \"‰∏¥Êó∂NPC:ÂßìÂêç\")\ntype CharacterKey =\n  | Exclude<keyof SchemaType, '‰∏ñÁïå' | 'Â∫áÊä§ÊâÄ' | 'Ê•ºÂ±ÇÂÖ∂‰ªñ‰ΩèÊà∑' | 'ÊàøÈó¥' | '‰∏ªÁ∫ø‰ªªÂä°' | '‰∏¥Êó∂NPC'>\n  | string;\n\nconst CHARACTER_ORDER = [\n  'ËÆ∏ËåÇÊñá',\n  'Áõ∏Áî∞Âì≤‰πü',\n  'Êù®ÂπÇ',\n  'Êó©Â∑ùÈÅ•',\n  'Êó©Â∑ùËàû',\n  'Â§èËàíÂÖ∞',\n  '‰∏≠ÊùëÊÉ†Â≠ê',\n  // 'Áà±ÂÆ´ÂøÉÁà±',\n  // 'ÂîêÂ´£',\n  'Ê°É‰πê‰∏ù„ÉªÊ≥ΩÂ∑¥Âìà',\n  // '‰ΩïÈìÉ',\n  'ÊùéÊ∏ÖÊ≥¢',\n  // 'Â∫∑ÁªÆÊúà',\n  // 'ÈôàÈõ™Êô¥',\n  'Â∞èÊ≥ΩËä±',\n] as const;\n\nconst store = useDataStore();\n\nconst RESERVED_KEYS = new Set(['‰∏ñÁïå', 'Â∫áÊä§ÊâÄ', 'ÊàøÈó¥', '‰∏ªÁ∫ø‰ªªÂä°', 'Ê•ºÂ±ÇÂÖ∂‰ªñ‰ΩèÊà∑', '‰∏¥Êó∂NPC']);\n\nfunction isRoleLike(val: any): boolean {\n  if (!val || typeof val !== 'object') return false;\n  return 'ÁôªÂú∫Áä∂ÊÄÅ' in val && 'ÂÅ•Â∫∑' in val;\n}\n\nfunction listExtraCoreKeys(): string[] {\n  const data = store.data as Record<string, any>;\n  return Object.keys(data)\n    .filter(key => !RESERVED_KEYS.has(key))\n    .filter(key => !CHARACTER_ORDER.includes(key as (typeof CHARACTER_ORDER)[number]))\n    .filter(key => typeof key === 'string' && key.length > 0 && !key.startsWith('_'))\n    .filter(key => isRoleLike(data[key]))\n    .sort();\n}\n\nconst active_character_keys = computed<CharacterKey[]>(() => {\n  const isActive = (key: CharacterKey) => getCharacter(key)?.ÁôªÂú∫Áä∂ÊÄÅ === 'ÁôªÂú∫';\n\n  const data = store.data as Record<string, any>;\n\n  // 1. Âõ∫ÂÆöËßíËâ≤ÊåâÂõ∫ÂÆöÈ°∫Â∫è\n  const fixedKeys = CHARACTER_ORDER.filter(key => isRoleLike(data[key]));\n  const fixedActive = fixedKeys.filter(isActive);\n  const fixedInactive = fixedKeys.filter(k => !isActive(k));\n\n  // 2. ËøΩÂä†ËßíËâ≤ÔºàÈ°∂Â±ÇÈùûÂõ∫ÂÆöËßíËâ≤Ôºâ\n  const extraKeys = listExtraCoreKeys();\n  const extraActive = extraKeys.filter(isActive);\n  const extraInactive = extraKeys.filter(k => !isActive(k));\n\n  // 3. ‰∏¥Êó∂ NPCÔºàÊåâÂêçÁß∞Â≠óÂÖ∏Â∫èÔºâ\n  const tempActive: CharacterKey[] = [];\n  const tempInactive: CharacterKey[] = [];\n  const tempNPCs = store.data.‰∏¥Êó∂NPC;\n  if (tempNPCs && typeof tempNPCs === 'object') {\n    const npcNames = Object.keys(tempNPCs).sort();\n    const npcActive = npcNames.filter(name => isActive(`‰∏¥Êó∂NPC:${name}`));\n    const npcInactive = npcNames.filter(name => !isActive(`‰∏¥Êó∂NPC:${name}`));\n    npcActive.forEach(name => tempActive.push(`‰∏¥Êó∂NPC:${name}`));\n    npcInactive.forEach(name => tempInactive.push(`‰∏¥Êó∂NPC:${name}`));\n  }\n\n  // ÊéíÂ∫èÔºöÁôªÂú∫ËßíËâ≤‰ºòÂÖàÔºõÁôªÂú∫/Á¶ªÂú∫ÂÜÖÈÉ®È°∫Â∫èÔºöÂõ∫ÂÆöÂêçÂçï ‚Üí ËøΩÂä†ËßíËâ≤ ‚Üí ‰∏¥Êó∂NPC\n  return [...fixedActive, ...extraActive, ...tempActive, ...fixedInactive, ...extraInactive, ...tempInactive];\n});\n\nconst active_character_key = ref<CharacterKey | null>(null);\nconst deletingRoleName = ref<string | null>(null);\n\nwatch(\n  active_character_keys,\n  keys => {\n    if (keys.length === 0) {\n      active_character_key.value = null;\n      return;\n    }\n\n    if (!active_character_key.value || !keys.includes(active_character_key.value)) {\n      active_character_key.value = keys[0];\n    }\n  },\n  { immediate: true },\n);\n\nfunction getCharacter(key: CharacterKey) {\n  // Êüê‰∫õËΩ¨ËØëÊµÅ‰ºöÊääÊó•Êñá‰∏≠ÁÇπÊõøÊç¢ÊàêÂç†‰ΩçÁ¨¶„Äå?„ÄçÔºåÊü•ÊâæÂâçÂÖàËøòÂéü\n  const normalizedKey = typeof key === 'string' ? key.replace(/\\?/g, '„Éª') : key;\n\n  if (typeof key === 'string' && key.startsWith('‰∏¥Êó∂NPC:')) {\n    const realName = key.split(':')[1];\n    return store.data.‰∏¥Êó∂NPC[realName];\n  }\n  return store.data[normalizedKey as keyof typeof store.data] as any;\n}\n\nfunction isTempNpcKey(key: CharacterKey): boolean {\n  return typeof key === 'string' && key.startsWith('‰∏¥Êó∂NPC:');\n}\n\nfunction getTempNpcName(key: CharacterKey): string {\n  if (!isTempNpcKey(key)) return '';\n  return String(key.split(':')[1] ?? '').trim();\n}\n\nfunction getRoleNameKey(key: CharacterKey): string {\n  if (isTempNpcKey(key)) return getTempNpcName(key);\n  if (typeof key === 'string') return key.replace(/\\?/g, '„Éª');\n  return String(key);\n}\n\nfunction canDeleteRole(key: CharacterKey): boolean {\n  return !!getRoleNameKey(key);\n}\n\nasync function confirmDeleteRole(name: string, isTemp: boolean): Promise<boolean> {\n  const title = isTemp ? `Á°ÆÂÆöÂà†Èô§‰∏¥Êó∂NPC„Äå${name}„ÄçÔºü` : `Á°ÆÂÆöÂà†Èô§ËßíËâ≤„Äå${name}„ÄçÔºü`;\n  const hint = isTemp\n    ? 'Â∞Ü‰ªéÂΩìÂâçÊ•ºÂ±ÇÂèòÈáè‰∏≠ÁßªÈô§ËØ•‰∏¥Êó∂NPCÔºåÂπ∂ÈáçËΩΩÊú¨Ê•ºÂ±ÇUI‰ª•Âà∑Êñ∞ÊòæÁ§∫„ÄÇ'\n    : 'Â∞Ü‰ªéÂΩìÂâçÊ•ºÂ±ÇÂèòÈáè‰∏≠ÁßªÈô§ËØ•ËßíËâ≤ÔºàÂê´Âõ∫ÂÆöËßíËâ≤/‰∏ªËßíÔºâÔºåÂπ∂ÈáçËΩΩÊú¨Ê•ºÂ±ÇUI‰ª•Âà∑Êñ∞ÊòæÁ§∫„ÄÇ';\n  const content = `${title}\\n\\n${hint}`;\n\n  try {\n    if (typeof (SillyTavern as any)?.callGenericPopup === 'function') {\n      const result = await SillyTavern.callGenericPopup(content, SillyTavern.POPUP_TYPE.CONFIRM);\n      return result === SillyTavern.POPUP_RESULT.AFFIRMATIVE || result === true;\n    }\n  } catch {\n    // ignore and fallback\n  }\n\n  return window.confirm(content);\n}\n\nfunction pruneNameFromRooms(stat_data: any, name: string) {\n  const n = String(name ?? '').trim();\n  if (!n) return;\n\n  const rooms = _.get(stat_data, 'ÊàøÈó¥', null);\n  if (!rooms || typeof rooms !== 'object') return;\n\n  const pruneList = (path: string) => {\n    const list = _.get(rooms, path, null);\n    if (!Array.isArray(list)) return;\n    const next = list.filter(x => String(x ?? '').trim() !== n);\n    if (!_.isEqual(next, list)) _.set(rooms, path, next);\n  };\n\n  pruneList('ÁéÑÂÖ≥.‰∏¥Êó∂ÂÆ¢ÊàøAÂÖ•‰ΩèËÄÖ');\n  pruneList('ÁéÑÂÖ≥.‰∏¥Êó∂ÂÆ¢ÊàøBÂÖ•‰ΩèËÄÖ');\n  pruneList('Ê†∏ÂøÉÂå∫.ÂÆ¢ÂéÖ‰ΩøÁî®ËÄÖ');\n  pruneList('Ê†∏ÂøÉÂå∫.È§êÂéÖÂé®Êàø‰ΩøÁî®ËÄÖ');\n  pruneList('Ê†∏ÂøÉÂå∫.‰∏ªÂçßÂÆ§‰ΩøÁî®ËÄÖ');\n  pruneList('Ê†∏ÂøÉÂå∫.‰∏ªÊµ¥ÂÆ§‰ΩøÁî®ËÄÖ');\n\n  const floorKeys = ['Ê•ºÂ±ÇÊàøÈó¥.Ê•ºÂ±Ç20ÊàøÈó¥', 'Ê•ºÂ±ÇÊàøÈó¥.Ê•ºÂ±Ç19ÊàøÈó¥'];\n  for (const baseKey of floorKeys) {\n    const record = _.get(rooms, baseKey, null);\n    if (!record || typeof record !== 'object') continue;\n    for (const roomNumber of Object.keys(record)) {\n      pruneList(`${baseKey}.${roomNumber}.ÂÖ•‰ΩèËÄÖ`);\n    }\n  }\n}\n\nasync function onClickDeleteRole(key: CharacterKey) {\n  const isTemp = isTempNpcKey(key);\n  const name = getRoleNameKey(key);\n  if (!name) return;\n  if (deletingRoleName.value) return;\n\n  const ok = await confirmDeleteRole(name, isTemp);\n  if (!ok) return;\n\n  try {\n    deletingRoleName.value = name;\n    await waitGlobalInitialized('Mvu');\n\n    const message_id = getCurrentMessageId();\n    const mvu_data = Mvu.getMvuData({ type: 'message', message_id });\n\n    const existedCore = _.has(mvu_data, ['stat_data', name]);\n    const existedTemp = _.has(mvu_data, ['stat_data', '‰∏¥Êó∂NPC', name]);\n    if (!existedCore && !existedTemp) {\n      toastr.info(`ËßíËâ≤„Äå${name}„ÄçÂ∑≤‰∏çÂ≠òÂú®`);\n      reloadIframe();\n      return;\n    }\n\n    const removeCore = !isTemp && existedCore;\n    const removeTemp = isTemp ? existedTemp : existedTemp;\n    if (removeCore) _.unset(mvu_data, ['stat_data', name]);\n    if (removeTemp) _.unset(mvu_data, ['stat_data', '‰∏¥Êó∂NPC', name]);\n\n    const keepCore = existedCore && !removeCore;\n    const keepTemp = existedTemp && !removeTemp;\n    if (!keepCore && !keepTemp) {\n      pruneNameFromRooms(_.get(mvu_data, 'stat_data', {}), name);\n    }\n\n    await Mvu.replaceMvuData(mvu_data, { type: 'message', message_id });\n    toastr.success(`Â∑≤Âà†Èô§ËßíËâ≤„Äå${name}„Äç`);\n    reloadIframe();\n  } catch (e: any) {\n    console.error('[CharactersSection] delete role failed', e);\n    toastr.error(`Âà†Èô§Â§±Ë¥•Ôºö${e?.message ?? e}`);\n  } finally {\n    deletingRoleName.value = null;\n  }\n}\n\nfunction getCharacterChange(key: CharacterKey) {\n  const char = getCharacter(key);\n  if (!char || !char.ÂÅ•Â∫∑Êõ¥Êñ∞ÂéüÂõ†) return '';\n  return char.ÂÅ•Â∫∑Êõ¥Êñ∞ÂéüÂõ†;\n}\n\nfunction getCharacterDisplayName(key: CharacterKey) {\n  const char = getCharacter(key);\n  const name = typeof char?.ÂßìÂêç === 'string' ? char.ÂßìÂêç.trim() : '';\n  // Â¶ÇÊûúÊòØ‰∏¥Êó∂NPCÔºåÂéªÊéâÂâçÁºÄÊòæÁ§∫\n  if (typeof key === 'string' && key.startsWith('‰∏¥Êó∂NPC:')) {\n    return key.split(':')[1];\n  }\n  return name ? name : key;\n}\n\nfunction getCharacterStatus(key: CharacterKey) {\n  const char = getCharacter(key);\n  return char?.ÁôªÂú∫Áä∂ÊÄÅ ?? 'Á¶ªÂú∫';\n}\n\nfunction setActiveCharacter(key: CharacterKey) {\n  active_character_key.value = key;\n}\n\nfunction healthPercent(key: CharacterKey) {\n  const char = getCharacter(key);\n  const health = char?.ÂÅ•Â∫∑;\n  if (typeof health !== 'number') return 0;\n  return _.clamp(health, 0, 100);\n}\n\nfunction imprintPercent(key: CharacterKey) {\n  const char = getCharacter(key);\n  const mark = char?.Áß©Â∫èÂàªÂç∞;\n  if (typeof mark !== 'number') return 0;\n  return _.clamp(mark, 0, 100);\n}\n\nfunction getRelationStage(key: CharacterKey) {\n  const char = getCharacter(key);\n  if (char?.ÂÖ≥Á≥ª) return char.ÂÖ≥Á≥ª;\n  // fallback: Êé®Êñ≠Ëá™Áß©Â∫èÂàªÂç∞Êï∞ÂÄº\n  const mark = typeof char?.Áß©Â∫èÂàªÂç∞ === 'number' ? char.Áß©Â∫èÂàªÂç∞ : null;\n  if (mark === null) return 'Êú™Áü•';\n  if (mark <= 0) return 'Êó†';\n  if (mark < 20) return 'ÊãíÁªù';\n  if (mark < 40) return '‰∫§Êòì';\n  if (mark < 60) return 'È°∫‰ªé';\n  if (mark < 90) return 'Âø†ËØö';\n  return 'ÊÄßÂ•¥';\n}\n\nfunction getRelationTendency(key: CharacterKey) {\n  const char = getCharacter(key);\n  return char?.ÂÖ≥Á≥ªÂÄæÂêë ?? 'Êú™Áü•';\n}\n\nfunction getRelationRangeText(key: CharacterKey) {\n  const relation = getRelationStage(key);\n  switch (relation) {\n    case 'Êó†':\n      return '-20 - 0';\n    case 'ÊãíÁªù':\n      return '1 - 19';\n    case '‰∫§Êòì':\n      return '20 - 39';\n    case 'È°∫‰ªé':\n      return '40 - 59';\n    case 'Âø†ËØö':\n      return '60 - 89';\n    case 'ÊÄßÂ•¥':\n      return '90 - 100';\n    default:\n      return '-20 - 100';\n  }\n}\n\nfunction getImprintChange(key: CharacterKey) {\n  const char = getCharacter(key);\n  return char?.Áß©Â∫èÂàªÂç∞Êõ¥Êñ∞ÂéüÂõ† ?? '';\n}\n</script>\n\n<style scoped>\n.imprint-section .progress-bar-value {\n  background: linear-gradient(90deg, #7aa2f7, #f1fa8c);\n}\n.imprint-status-subtext {\n  margin-top: 4px;\n  color: var(--accent-blue, #8be9fd);\n  font-size: 0.9em;\n}\n.imprint-hint {\n  color: var(--text-color);\n  opacity: 0.7;\n}\n\n.imprint-change {\n  color: var(--accent-gold, #f1fa8c);\n}\n.imprint-bar {\n  margin-top: 6px;\n}\n</style>\n\n<style scoped>\n.role-remove-btn {\n  margin-left: 10px;\n  width: 22px;\n  height: 22px;\n  border-radius: 999px;\n  border: 1px solid rgba(255, 90, 90, 0.55);\n  background: rgba(255, 90, 90, 0.12);\n  color: rgba(255, 150, 150, 0.98);\n  font-weight: 900;\n  line-height: 1;\n  cursor: pointer;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  transition:\n    transform 0.12s ease,\n    opacity 0.12s ease;\n}\n\n.role-remove-btn:hover {\n  transform: scale(1.04);\n}\n\n.role-remove-btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  transform: none;\n}\n\n.status-pill {\n  margin-left: 8px;\n  padding: 2px 6px;\n  border-radius: 6px;\n  font-size: 0.75em;\n  border: 1px solid var(--border-color, rgba(255, 255, 255, 0.2));\n  background: rgba(255, 255, 255, 0.05);\n}\n.status-pill.ÁôªÂú∫ {\n  color: #50fa7b;\n  border-color: #50fa7b55;\n  background: #50fa7b11;\n}\n.status-pill.Á¶ªÂú∫ {\n  color: #f1fa8c;\n  border-color: #f1fa8c55;\n  background: #f1fa8c11;\n}\n</style>\n","<template>\n  <section class=\"section\">\n    <button ref=\"palette_button\" class=\"palette-button\" type=\"button\" @click.stop=\"togglePalette\">üé®</button>\n    <h2 class=\"section-title choices-title\">‚öúÔ∏è Âø´ÈÄüÂâßÊÉÖ ‚öúÔ∏è</h2>\n\n    <div>\n      <template v-if=\"props.options.length > 0\">\n        <button\n          v-for=\"(opt, idx) in props.options\"\n          :key=\"idx\"\n          class=\"choice-item\"\n          type=\"button\"\n          @click=\"openChoiceDialog(opt)\"\n        >\n          {{ opt }}\n        </button>\n      </template>\n      <template v-else>\n        <button class=\"choice-item\" type=\"button\" disabled>ÂΩìÂâçÊó†ÈÄâÈ°πÔºåËØ∑Ëá™Áî±Ë°åÂä®...</button>\n      </template>\n    </div>\n\n    <Teleport to=\"body\">\n      <div\n        v-if=\"choiceDialogOpen\"\n        class=\"choice-modal-mask\"\n        :style=\"choiceModalMaskStyle\"\n        @click.self=\"closeChoiceDialog\"\n      >\n        <div class=\"choice-modal\" role=\"dialog\" aria-modal=\"true\">\n          <div class=\"choice-modal-header\">\n            <div class=\"choice-modal-title\">ÊÇ®ËøòÊúâË¶ÅË°•ÂÖÖÁöÑÂêóÔºü</div>\n            <button class=\"choice-icon-btn\" type=\"button\" @click=\"closeChoiceDialog\">‚úï</button>\n          </div>\n\n          <div class=\"choice-modal-body\">\n            <div class=\"choice-original-label\">ÈÄâÈ°πÂéüÊñá</div>\n            <div class=\"choice-original\">{{ choiceDialogOriginal }}</div>\n\n            <div class=\"choice-edit-label\">ÁºñËæëÂêéÂèëÈÄÅ</div>\n            <textarea v-model=\"choiceDialogDraft\" class=\"choice-textarea\" rows=\"6\" placeholder=\"Âú®Ê≠§Ë°•ÂÖÖÊàñ‰øÆÊîπ‚Ä¶‚Ä¶\" />\n          </div>\n\n          <div class=\"choice-modal-footer\">\n            <button\n              class=\"choice-btn choice-btn--ghost\"\n              type=\"button\"\n              :disabled=\"choiceSending\"\n              @click=\"closeChoiceDialog\"\n            >\n              ÂèñÊ∂à\n            </button>\n            <button\n              class=\"choice-btn choice-btn--primary\"\n              type=\"button\"\n              :disabled=\"choiceSending\"\n              @click=\"confirmChoiceDialog\"\n            >\n              Á°ÆËÆ§ÂèëÈÄÅ\n            </button>\n          </div>\n        </div>\n      </div>\n    </Teleport>\n\n    <div ref=\"palette_modal\" class=\"palette-modal\" :class=\"{ show: palette_open }\">\n      <h3>ÊòæÁ§∫ËÆæÁΩÆ</h3>\n      <div class=\"palette-option\">\n        <label>üé® ‰∏ªÈ¢ò</label>\n        <select v-model=\"theme\">\n          <option value=\"apocalypse_tech\">Êú´Êó•ÁßëÊäÄ (ÈªòËÆ§)</option>\n          <option value=\"jade_green\">Ê∑°Áø°Áø†Áªø</option>\n          <option value=\"parchment\">Â§çÂè§ÁæäÁöÆÁ∫∏</option>\n          <option value=\"milky\">Ê∏ÖÊñ∞Â•∂ÁôΩ</option>\n        </select>\n      </div>\n      <div class=\"palette-option\">\n        <label>üñãÔ∏è Â≠ó‰Ωì</label>\n        <select v-model=\"font_key\">\n          <option value=\"yahei\">ÂæÆËΩØÈõÖÈªë (ÈªòËÆ§)</option>\n          <option value=\"simsun\">ÂÆã‰Ωì</option>\n          <option value=\"kaiti\">Ê•∑‰Ωì</option>\n        </select>\n      </div>\n      <div class=\"palette-option\">\n        <label>‚ÜîÔ∏è Â≠ó‰ΩìÂ§ßÂ∞è</label>\n        <select v-model=\"font_size\">\n          <option value=\"12\">12px (ÊúÄÂ∞è)</option>\n          <option value=\"14\">14px (ËæÉÂ∞è)</option>\n          <option value=\"15\">15px (Á®çÂ∞è)</option>\n          <option value=\"16\">16px (ÈªòËÆ§)</option>\n          <option value=\"18\">18px (Á®çÂ§ß)</option>\n          <option value=\"20\">20px (ËæÉÂ§ß)</option>\n          <option value=\"22\">22px (ÂæàÂ§ß)</option>\n          <option value=\"24\">24px (ÊúÄÂ§ß)</option>\n        </select>\n      </div>\n      <div class=\"palette-buttons\">\n        <button class=\"palette-close\" type=\"button\" @click=\"palette_open = false\">ÂÖ≥Èó≠</button>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script setup lang=\"ts\">\nimport { nextTick } from 'vue';\nimport { CHAT_VAR_KEYS, copyText, sendToChat } from '../../outbound';\n\nconst props = defineProps<{\n  options: string[];\n}>();\n\nconst palette_open = ref(false);\nconst theme = useLocalStorage<string>('eden_theme', 'apocalypse_tech');\nconst font_key = useLocalStorage<string>('eden_font_key', 'yahei');\nconst font_size = useLocalStorage<string>('eden_font_size_key', '16');\n\nfunction loadPersistedSettings() {\n  const vars = getVariables({ type: 'chat' }) ?? {};\n  const saved = _.get(vars, CHAT_VAR_KEYS.UI_SETTINGS, {}) as Record<string, string>;\n  if (typeof saved.theme === 'string') theme.value = saved.theme;\n  if (typeof saved.font_key === 'string') font_key.value = saved.font_key;\n  if (typeof saved.font_size === 'string') font_size.value = saved.font_size;\n}\n\nwatch(\n  [theme, font_key, font_size],\n  ([t, f, s]) => {\n    updateVariablesWith(\n      vars => {\n        _.set(vars, CHAT_VAR_KEYS.UI_SETTINGS, { theme: t, font_key: f, font_size: s });\n        return vars;\n      },\n      { type: 'chat' },\n    );\n  },\n  { immediate: false },\n);\n\nconst palette_button = ref<HTMLElement | null>(null);\nconst palette_modal = ref<HTMLElement | null>(null);\n\nconst choiceDialogOpen = ref(false);\nconst choiceDialogOriginal = ref('');\nconst choiceDialogDraft = ref('');\nconst choiceSending = ref(false);\nconst choiceModalViewportTop = ref(0);\nconst choiceModalViewportHeight = ref(0);\nlet choiceParentScrollTarget: HTMLElement | Window | null = null;\n\nconst choiceModalMaskStyle = computed(() => ({\n  top: `${choiceModalViewportTop.value}px`,\n  height: `${choiceModalViewportHeight.value}px`,\n}));\n\nfunction getParentScrollContainer(frameEl: HTMLElement): HTMLElement | Window {\n  try {\n    const doc = frameEl.ownerDocument;\n    const win = doc.defaultView ?? window.parent;\n    let cur: HTMLElement | null = frameEl.parentElement;\n    while (cur) {\n      const style = win.getComputedStyle(cur);\n      const overflowY = style.overflowY;\n      if ((overflowY === 'auto' || overflowY === 'scroll') && cur.scrollHeight > cur.clientHeight + 1) {\n        return cur;\n      }\n      cur = cur.parentElement;\n    }\n    return win;\n  } catch {\n    return window.parent;\n  }\n}\n\nfunction updateChoiceModalViewport() {\n  const frameEl = window.frameElement as HTMLElement | null;\n  if (!frameEl) return;\n  const parentWin = window.parent as Window | null;\n  if (!parentWin) return;\n\n  const rect = frameEl.getBoundingClientRect();\n  const topInIframeDoc = Math.max(0, -rect.top);\n  choiceModalViewportTop.value = topInIframeDoc;\n  choiceModalViewportHeight.value = Math.max(0, parentWin.innerHeight);\n}\n\nfunction bindChoiceParentScrollSync() {\n  const frameEl = window.frameElement as HTMLElement | null;\n  if (!frameEl) return;\n  choiceParentScrollTarget = getParentScrollContainer(frameEl);\n  const handler = updateChoiceModalViewport;\n\n  if (choiceParentScrollTarget instanceof Window) {\n    choiceParentScrollTarget.addEventListener('scroll', handler, { passive: true });\n    choiceParentScrollTarget.addEventListener('resize', handler, { passive: true });\n  } else {\n    choiceParentScrollTarget.addEventListener('scroll', handler, { passive: true });\n    window.parent?.addEventListener?.('resize', handler, { passive: true });\n  }\n}\n\nfunction unbindChoiceParentScrollSync() {\n  const handler = updateChoiceModalViewport;\n  if (choiceParentScrollTarget instanceof Window) {\n    choiceParentScrollTarget.removeEventListener('scroll', handler as any);\n    choiceParentScrollTarget.removeEventListener('resize', handler as any);\n  } else if (choiceParentScrollTarget) {\n    choiceParentScrollTarget.removeEventListener('scroll', handler as any);\n    window.parent?.removeEventListener?.('resize', handler as any);\n  }\n  choiceParentScrollTarget = null;\n}\n\nfunction togglePalette() {\n  palette_open.value = !palette_open.value;\n}\n\nwatch(\n  theme,\n  value => {\n    if (value === 'apocalypse_tech') {\n      delete document.documentElement.dataset.theme;\n      return;\n    }\n    document.documentElement.dataset.theme = value;\n  },\n  { immediate: true },\n);\n\nwatch(\n  font_key,\n  value => {\n    const main = document.getElementById('eden-main-container');\n    if (!main) return;\n\n    const fontMap: Record<string, string> = {\n      yahei: '\"Microsoft YaHei\", sans-serif',\n      simsun: 'SimSun, serif',\n      kaiti: 'KaiTi, serif',\n    };\n\n    main.style.fontFamily = fontMap[value] || fontMap.yahei;\n  },\n  { immediate: true },\n);\n\nwatch(\n  font_size,\n  value => {\n    const main = document.getElementById('eden-main-container');\n    if (!main) return;\n    main.style.setProperty('--font-size-main', `${value}px`);\n  },\n  { immediate: true },\n);\n\nasync function openChoiceDialog(text: string) {\n  choiceDialogOriginal.value = String(text ?? '');\n  choiceDialogDraft.value = String(text ?? '');\n  choiceDialogOpen.value = true;\n  updateChoiceModalViewport();\n  bindChoiceParentScrollSync();\n\n  await nextTick();\n  const el = document.querySelector<HTMLTextAreaElement>('.choice-textarea');\n  el?.focus?.();\n  try {\n    el?.setSelectionRange?.(el.value.length, el.value.length);\n  } catch {\n    // ignore\n  }\n}\n\nfunction closeChoiceDialog() {\n  choiceDialogOpen.value = false;\n  choiceSending.value = false;\n  unbindChoiceParentScrollSync();\n}\n\nasync function confirmChoiceDialog() {\n  if (choiceSending.value) return;\n  const text = String(choiceDialogDraft.value ?? '').trim();\n  if (!text) {\n    toastr?.warning?.('ËØ∑ËæìÂÖ•Ë¶ÅÂèëÈÄÅÁöÑÂÜÖÂÆπ', 'Âø´ÈÄüÂâßÊÉÖ');\n    return;\n  }\n\n  choiceSending.value = true;\n  try {\n    const res = sendToChat(text, {\n      toast: true,\n      successMessage: 'Â∑≤ÂèëÈÄÅ',\n      failureMessage: 'ÂèëÈÄÅÂ§±Ë¥•ÔºåÂ∑≤Â∞ùËØïÂ§çÂà∂ÔºåËØ∑ÊâãÂä®ÂèëÈÄÅ',\n      unavailableMessage: 'Êó†Ê≥ïÁõ¥Êé•ÂèëÈÄÅÔºåÂ∑≤Â∞ùËØïÂ§çÂà∂ÔºåËØ∑ÊâãÂä®ÂèëÈÄÅ',\n    });\n\n    if (res.ok) {\n      closeChoiceDialog();\n      return;\n    }\n\n    await copyText(text, { toast: false });\n    if (!(toastr as any)?.error) {\n      alert(`${res.reason}: ${res.sentText}`);\n    }\n  } finally {\n    choiceSending.value = false;\n  }\n}\n\nfunction onDocumentClick(ev: MouseEvent) {\n  if (!palette_open.value) return;\n  const target = ev.target as Node | null;\n  if (!target) return;\n\n  if (palette_modal.value?.contains(target)) return;\n  if (palette_button.value?.contains(target)) return;\n  palette_open.value = false;\n}\n\nonMounted(() => {\n  loadPersistedSettings();\n  document.addEventListener('click', onDocumentClick);\n});\n\nonBeforeUnmount(() => {\n  document.removeEventListener('click', onDocumentClick);\n  unbindChoiceParentScrollSync();\n});\n</script>\n\n<style scoped>\n.choice-modal-mask {\n  position: absolute;\n  left: 0;\n  right: 0;\n  z-index: 60;\n  background: rgba(0, 0, 0, 0.55);\n  padding-top: calc(12px + env(safe-area-inset-top));\n  padding-right: calc(12px + env(safe-area-inset-right));\n  padding-bottom: calc(12px + env(safe-area-inset-bottom));\n  padding-left: calc(12px + env(safe-area-inset-left));\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.choice-modal {\n  width: min(560px, calc(100% - 8px));\n  max-height: calc(100% - 8px);\n  background: rgba(25, 28, 35, 0.98);\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  border-radius: 14px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.45);\n  display: flex;\n  flex-direction: column;\n}\n\n.choice-modal-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 12px 8px;\n}\n\n.choice-modal-title {\n  font-weight: 800;\n  color: var(--text-strong, #f1fa8c);\n}\n\n.choice-icon-btn {\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(255, 255, 255, 0.06);\n  color: var(--text-color);\n  border-radius: 10px;\n  padding: 6px 10px;\n  cursor: pointer;\n}\n\n.choice-modal-body {\n  padding: 8px 12px 0;\n  overflow: auto;\n}\n\n.choice-original-label,\n.choice-edit-label {\n  font-size: 0.85em;\n  opacity: 0.9;\n  margin: 6px 0 6px;\n}\n\n.choice-original {\n  padding: 10px 12px;\n  border-radius: 10px;\n  background: rgba(255, 255, 255, 0.06);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  line-height: 1.45;\n  word-break: break-word;\n}\n\n.choice-textarea {\n  width: 100%;\n  margin-top: 4px;\n  padding: 10px 12px;\n  border-radius: 10px;\n  background: rgba(0, 0, 0, 0.22);\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  color: var(--text-color);\n  outline: none;\n  resize: vertical;\n  font-family: inherit;\n}\n\n.choice-textarea:focus {\n  border-color: rgba(0, 180, 216, 0.55);\n  box-shadow: 0 0 0 2px rgba(0, 180, 216, 0.2);\n}\n\n.choice-modal-footer {\n  padding: 10px 12px 12px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n  display: flex;\n  gap: 8px;\n  justify-content: flex-end;\n}\n\n.choice-btn {\n  padding: 8px 10px;\n  border-radius: 10px;\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  background-color: rgba(255, 255, 255, 0.06);\n  color: var(--text-color);\n  cursor: pointer;\n  font-size: 0.9em;\n}\n\n.choice-btn--primary {\n  border-color: rgba(0, 180, 216, 0.55);\n  background-color: rgba(0, 180, 216, 0.18);\n  color: #e8fbff;\n  font-weight: 700;\n}\n\n.choice-btn--ghost {\n  background-color: transparent;\n}\n\n.choice-btn:disabled {\n  opacity: 0.55;\n  cursor: not-allowed;\n}\n</style>\n","<template>\n  <section id=\"mission-section\" class=\"section\">\n    <h2 class=\"section-title\">\n      üìú ‰∏ªÁ∫ø‰ªªÂä° üìú\n      <span v-if=\"hasMissionNew\" class=\"new-dot\" aria-label=\"ÊúâÊñ∞ËøõÂ±ï\"></span>\n    </h2>\n    <div class=\"mission-content\">\n      <!-- ÂΩìÂâçÈò∂ÊÆµ -->\n      <div class=\"mission-phase\">\n        <div class=\"phase-label\">üìç ÂΩìÂâçÈò∂ÊÆµ</div>\n        <div class=\"phase-name\">{{ store.data.‰∏ªÁ∫ø‰ªªÂä°.ÂΩìÂâçÈò∂ÊÆµ }}</div>\n      </div>\n\n      <!-- Èò∂ÊÆµÁõÆÊ†áËøõÂ∫¶Êù° -->\n      <div class=\"goals-progress-bar\">\n        <div class=\"progress-header\">\n          <span>üéØ Èò∂ÊÆµÁõÆÊ†áËøõÂ∫¶</span>\n          <span class=\"progress-text\">{{ completedGoals }}/{{ stageTargets.length }}</span>\n        </div>\n        <div class=\"progress-track\">\n          <div class=\"progress-fill\" :style=\"{ width: progressPercent + '%' }\"></div>\n        </div>\n      </div>\n\n      <!-- Èò∂ÊÆµÁõÆÊ†á -->\n      <div class=\"mission-goals\">\n        <button class=\"collapse-toggle-btn\" @click=\"isGoalsExpanded = !isGoalsExpanded\">\n          <span class=\"toggle-icon\">{{ isGoalsExpanded ? '‚ñº' : '‚ñ∂' }}</span>\n          <span class=\"toggle-text\">üìã ÁõÆÊ†áÊ∏ÖÂçï</span>\n          <span class=\"goals-count\">({{ completedGoals }}/{{ stageTargets.length }})</span>\n        </button>\n        <div v-show=\"isGoalsExpanded\" class=\"goals-list\">\n          <template v-if=\"stageTargets.length > 0\">\n            <div\n              v-for=\"(goal, idx) in stageTargets\"\n              :key=\"goal.key || idx\"\n              class=\"goal-item\"\n              :class=\"{ completed: isGoalCompleted(goal.key, idx) }\"\n            >\n              <div class=\"goal-checkbox\">\n                <svg v-if=\"isGoalCompleted(goal.key, idx)\" viewBox=\"0 0 24 24\" class=\"check-icon\">\n                  <path d=\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\" />\n                </svg>\n                <svg v-else viewBox=\"0 0 24 24\" class=\"check-icon empty\">\n                  <circle cx=\"12\" cy=\"12\" r=\"10\" />\n                </svg>\n              </div>\n              <div class=\"goal-content\">\n                <div class=\"goal-text\" :class=\"{ completed: isGoalCompleted(goal.key, idx) }\">\n                  {{ getGoalText(goal) }}\n                </div>\n                <div class=\"goal-meta\" v-if=\"hasGoalProgress(goal)\">\n                  <span class=\"meta-chip\">ËøõÂ∫¶Ôºö{{ goal.ÂΩìÂâçÂÄº ?? 0 }}/{{ goal.ÁõÆÊ†áÂÄº ?? 0 }}</span>\n                </div>\n                <span v-if=\"isGoalCompleted(goal.key, idx)\" class=\"goal-status-tag\">Â∑≤ÂÆåÊàê</span>\n              </div>\n            </div>\n          </template>\n          <template v-else>\n            <div class=\"goal-item empty\">(ÊöÇÊó†ÁõÆÊ†á)</div>\n          </template>\n        </div>\n      </div>\n\n      <!-- ÊÉÖÊä•Á¢éÁâá -->\n      <div class=\"mission-intel\">\n        <button class=\"collapse-toggle-btn\" @click=\"isIntelExpanded = !isIntelExpanded\">\n          <span class=\"toggle-icon\">{{ isIntelExpanded ? '‚ñº' : '‚ñ∂' }}</span>\n          <span class=\"toggle-text\">üîç ÊÉÖÊä•Á¢éÁâá</span>\n          <span class=\"intel-count\">({{ intelCompleted }}/{{ intelTotal }})</span>\n        </button>\n        <div v-if=\"intelTotal === 0\" class=\"intel-empty-hint\">ÊöÇÊó†ÊÉÖÊä•Á¢éÁâáÔºåÁªßÁª≠Êé¢Á¥¢/ÊêúÂàÆÂèØËß£ÈîÅÊñ∞ÁöÑÁ∫øÁ¥¢„ÄÇ</div>\n        <div v-show=\"isIntelExpanded\" class=\"intel-list\">\n          <template v-if=\"intelTotal > 0\">\n            <div v-for=\"(intel, key) in store.data.‰∏ªÁ∫ø‰ªªÂä°.ÊÉÖÊä•Á¢éÁâá\" :key=\"key\" class=\"intel-item\" :class=\"intel.Áä∂ÊÄÅ\">\n              <div class=\"intel-status-ring\" :class=\"intel.Áä∂ÊÄÅ\">\n                <svg viewBox=\"0 0 36 36\" class=\"progress-ring\">\n                  <circle cx=\"18\" cy=\"18\" r=\"16\" class=\"ring-bg\" />\n                  <circle\n                    cx=\"18\"\n                    cy=\"18\"\n                    r=\"16\"\n                    class=\"ring-progress\"\n                    :stroke-dasharray=\"getRingProgress(intel.Áä∂ÊÄÅ)\"\n                    :class=\"intel.Áä∂ÊÄÅ\"\n                  />\n                </svg>\n                <span class=\"ring-icon\">{{ getStatusIcon(intel.Áä∂ÊÄÅ) }}</span>\n              </div>\n              <div class=\"intel-content\">\n                <div class=\"intel-header\">\n                  <span class=\"intel-id\">{{ intel.ÁºñÂè∑ }}</span>\n                  <span class=\"intel-status-badge\" :class=\"intel.Áä∂ÊÄÅ\">{{ intel.Áä∂ÊÄÅ }}</span>\n                </div>\n                <div class=\"intel-desc\">{{ intel.ÊèèËø∞ }}</div>\n                <div class=\"intel-meta\">\n                  <span class=\"intel-value\">üí∞ {{ intel.‰ª∑ÂÄº }}</span>\n                  <span class=\"intel-risk\">‚ö†Ô∏è {{ intel.È£éÈô© }}</span>\n                  <span v-if=\"getIntelCleanupHint(key, intel)\" class=\"intel-deadline\">{{\n                    getIntelCleanupHint(key, intel)\n                  }}</span>\n                </div>\n              </div>\n            </div>\n          </template>\n          <template v-else>\n            <div class=\"intel-item empty\">(ÊöÇÊó†ÊÉÖÊä•Á¢éÁâá)</div>\n          </template>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from 'vue';\nimport { useDataStore } from '../../store';\n\nconst store = useDataStore();\nconst isGoalsExpanded = ref(false);\nconst isIntelExpanded = ref(false);\nconst currentMessageId = Number(getCurrentMessageId());\n\nconst hasMissionNew = computed(() => {\n  if (!Number.isFinite(currentMessageId) || currentMessageId <= 0) return false;\n  const meta = (store.data.‰∏ªÁ∫ø‰ªªÂä° as any)?.$meta;\n  if (!meta || typeof meta !== 'object') return false;\n\n  const intelMeta = (meta as any)?.ÊÉÖÊä•Á¢éÁâá ?? {};\n  if (intelMeta && typeof intelMeta === 'object') {\n    for (const v of Object.values(intelMeta as any)) {\n      if (!v || typeof v !== 'object') continue;\n      const createdAt = Number((v as any).created_at ?? 0);\n      const exploredAt = Number((v as any).explored_at ?? 0);\n      const completedAt = Number((v as any).completed_at ?? 0);\n      if (createdAt === currentMessageId || exploredAt === currentMessageId || completedAt === currentMessageId)\n        return true;\n    }\n  }\n\n  const goalsMeta = (meta as any)?.Èò∂ÊÆµÁõÆÊ†á ?? {};\n  if (goalsMeta && typeof goalsMeta === 'object') {\n    for (const v of Object.values(goalsMeta as any)) {\n      if (!v || typeof v !== 'object') continue;\n      const completedAt = Number((v as any).completed_at ?? 0);\n      if (completedAt === currentMessageId) return true;\n    }\n  }\n\n  return false;\n});\n\ntype StageTarget = { key: string; ÊèèËø∞: string; ÂΩìÂâçÂÄº: number; ÁõÆÊ†áÂÄº: number };\nconst stageTargets = computed<StageTarget[]>(() => {\n  const raw = store.data.‰∏ªÁ∫ø‰ªªÂä°.Èò∂ÊÆµÁõÆÊ†á as any;\n  if (Array.isArray(raw)) {\n    return (raw as any[]).map((t, idx) => ({\n      key: String(idx),\n      ÊèèËø∞: t?.ÊèèËø∞ ?? '',\n      ÂΩìÂâçÂÄº: Number(t?.ÂΩìÂâçÂÄº ?? 0),\n      ÁõÆÊ†áÂÄº: Number(t?.ÁõÆÊ†áÂÄº ?? 0),\n    }));\n  }\n  return Object.entries(raw ?? {}).map(([key, t]) => ({\n    key,\n    ÊèèËø∞: (t as any)?.ÊèèËø∞ ?? key,\n    ÂΩìÂâçÂÄº: Number((t as any)?.ÂΩìÂâçÂÄº ?? 0),\n    ÁõÆÊ†áÂÄº: Number((t as any)?.ÁõÆÊ†áÂÄº ?? 0),\n  }));\n});\n\nconst completedGoals = computed(() => stageTargets.value.filter((g, idx) => isGoalCompleted(g.key, idx)).length);\n\nconst progressPercent = computed(() => {\n  const total = stageTargets.value.length;\n  if (total === 0) return 0;\n  return Math.round((completedGoals.value / total) * 100);\n});\n\nfunction isGoalCompleted(goalKey: string, idx: number): boolean {\n  const status = store.data.‰∏ªÁ∫ø‰ªªÂä°.ÁõÆÊ†áÂÆåÊàêÁä∂ÊÄÅ ?? {};\n  if (goalKey in status) return status[goalKey] === true;\n  const fallbackKey = String(idx);\n  return status[fallbackKey] === true;\n}\n\nfunction getGoalText(goal: any): string {\n  if (!goal) return '';\n  if (typeof goal === 'string') return goal;\n  if (typeof goal === 'object' && 'ÊèèËø∞' in goal) return goal.ÊèèËø∞ as string;\n  return String(goal);\n}\n\nfunction hasGoalProgress(goal: any): boolean {\n  return goal && typeof goal === 'object' && goal.ÂΩìÂâçÂÄº !== undefined && goal.ÁõÆÊ†áÂÄº !== undefined;\n}\n\n// ÊÉÖÊä•Á¢éÁâáÁªüËÆ°\nconst intelTotal = computed(() => Object.keys(store.data.‰∏ªÁ∫ø‰ªªÂä°.ÊÉÖÊä•Á¢éÁâá).length);\nconst intelCompleted = computed(\n  () => Object.values(store.data.‰∏ªÁ∫ø‰ªªÂä°.ÊÉÖÊä•Á¢éÁâá).filter(i => i.Áä∂ÊÄÅ === 'Â∑≤ÂÆåÊàê').length,\n);\n\nfunction getIntelCleanupHint(key: string, intel: any): string | null {\n  const meta = (store.data.‰∏ªÁ∫ø‰ªªÂä° as any)?.$meta?.ÊÉÖÊä•Á¢éÁâá?.[key];\n  if (!meta || !Number.isFinite(currentMessageId)) return null;\n\n  const createdAt = Number(meta.created_at ?? 0);\n  const exploredAt = Number(meta.explored_at ?? 0);\n  const completedAt = Number(meta.completed_at ?? 0);\n\n  const status = String(intel?.Áä∂ÊÄÅ ?? '');\n  const doneLimit = 3;\n  const notDoneLimit = 5;\n\n  if (status === 'Â∑≤ÂÆåÊàê') {\n    const base = completedAt || exploredAt || createdAt;\n    if (!base) return null;\n    const remaining = doneLimit - (currentMessageId - base);\n    if (remaining <= 0) return 'Âç≥Â∞ÜËá™Âä®Ê∏ÖÁêÜÔºàÂ∑≤ÂÆåÊàêÔºâ';\n    return `Ââ©‰Ωô${remaining}Â±ÇËá™Âä®Ê∏ÖÁêÜÔºàÂ∑≤ÂÆåÊàêÔºâ`;\n  }\n\n  if (status === 'Â∑≤Êé¢Á¥¢') {\n    const base = exploredAt || createdAt;\n    if (!base) return null;\n    const remaining = doneLimit - (currentMessageId - base);\n    if (remaining <= 0) return 'Âç≥Â∞ÜËá™Âä®Ê∏ÖÁêÜÔºàÂ∑≤Êé¢Á¥¢Ôºâ';\n    return `Ââ©‰Ωô${remaining}Â±ÇËá™Âä®Ê∏ÖÁêÜÔºàÂ∑≤Êé¢Á¥¢Ôºâ`;\n  }\n\n  // Êú™Êé¢Á¥¢Ôºö5 Ê•ºÊó∂Èôê\n  const base = createdAt;\n  if (!base) return null;\n  const remaining = notDoneLimit - (currentMessageId - base);\n  if (remaining <= 0) return 'Â∑≤Ë∂ÖÊó∂ÔºöÂç≥Â∞ÜËá™Âä®Ê∏ÖÁêÜ';\n  return `Êó∂ÈôêÂâ©‰Ωô${remaining}Â±ÇÔºàÊú™ÂÆåÊàêÂ∞ÜÊ∏ÖÁêÜÔºâ`;\n}\n\nfunction getStatusIcon(status: string): string {\n  switch (status) {\n    case 'Â∑≤ÂÆåÊàê':\n      return '‚úì';\n    case 'Â∑≤Êé¢Á¥¢':\n      return '‚óê';\n    case 'Êú™Êé¢Á¥¢':\n      return '‚óã';\n    default:\n      return '‚óã';\n  }\n}\n\nfunction getRingProgress(status: string): string {\n  let progress = 33;\n  switch (status) {\n    case 'Â∑≤ÂÆåÊàê':\n      progress = 100;\n      break;\n    case 'Â∑≤Êé¢Á¥¢':\n      progress = 66;\n      break;\n    case 'Êú™Êé¢Á¥¢':\n      progress = 33;\n      break;\n  }\n  const circumference = 2 * Math.PI * 16;\n  const offset = circumference - (progress / 100) * circumference;\n  return `${progress} ${circumference} ${offset}`;\n}\n</script>\n\n<style scoped>\n.new-dot {\n  display: inline-block;\n  width: 8px;\n  height: 8px;\n  margin-left: 8px;\n  border-radius: 999px;\n  background: rgba(229, 57, 53, 0.9);\n  box-shadow:\n    0 0 0 2px rgba(0, 0, 0, 0.25),\n    0 0 10px rgba(229, 57, 53, 0.35);\n  vertical-align: middle;\n}\n\n.mission-content {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.mission-phase {\n  background-color: var(--bg-medium);\n  padding: 12px;\n  border-radius: 8px;\n  border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.phase-label {\n  font-size: 0.85em;\n  color: var(--text-color);\n  opacity: 0.8;\n  margin-bottom: 6px;\n}\n\n.phase-name {\n  font-size: 1em;\n  font-weight: bold;\n  color: var(--accent-gold);\n}\n\n/* ËøõÂ∫¶Êù° */\n.goals-progress-bar {\n  background-color: var(--bg-medium);\n  padding: 12px;\n  border-radius: 8px;\n  border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.progress-header {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 8px;\n  font-size: 0.9em;\n  color: var(--text-color);\n}\n\n.progress-text {\n  color: var(--accent-gold);\n  font-weight: bold;\n}\n\n.progress-track {\n  height: 8px;\n  background-color: var(--bg-dark);\n  border-radius: 4px;\n  overflow: hidden;\n}\n\n.progress-fill {\n  height: 100%;\n  background: linear-gradient(90deg, var(--dialog-color), var(--accent-gold));\n  border-radius: 4px;\n  transition: width 0.3s ease;\n}\n\n.mission-goals,\n.mission-intel {\n  margin-top: 4px;\n}\n\n.goals-count,\n.intel-count {\n  font-size: 0.85em;\n  opacity: 0.7;\n}\n\n.intel-empty-hint {\n  margin-top: 6px;\n  font-size: 0.8em;\n  color: var(--text-color);\n  opacity: 0.7;\n}\n\n.goals-list,\n.intel-list {\n  margin-top: 8px;\n  padding: 8px;\n  background-color: var(--bg-dark);\n  border-radius: 8px;\n}\n\n/* ÁõÆÊ†áÊ∏ÖÂçï */\n.goal-item {\n  display: flex;\n  align-items: flex-start;\n  gap: 10px;\n  padding: 10px 8px;\n  border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n  transition: all 0.2s ease;\n}\n\n.goal-item:last-child {\n  border-bottom: none;\n}\n\n.goal-item.empty {\n  color: var(--text-color);\n  opacity: 0.6;\n  justify-content: center;\n}\n\n.goal-item.completed {\n  background-color: rgba(80, 250, 123, 0.1);\n}\n\n.goal-checkbox {\n  width: 22px;\n  height: 22px;\n  flex-shrink: 0;\n  margin-top: 1px;\n}\n\n.check-icon {\n  width: 100%;\n  height: 100%;\n  fill: var(--dialog-color);\n}\n\n.check-icon.empty {\n  fill: var(--bg-light);\n  stroke: var(--text-color);\n  opacity: 0.5;\n}\n\n.goal-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n\n.goal-text {\n  font-size: 0.9em;\n  color: var(--text-color);\n  line-height: 1.4;\n  transition: all 0.2s ease;\n}\n\n.goal-meta {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n}\n\n.meta-chip {\n  font-size: 0.75em;\n  padding: 2px 6px;\n  border-radius: 6px;\n  background: rgba(255, 255, 255, 0.08);\n  color: var(--accent-blue);\n  border: 1px solid rgba(255, 255, 255, 0.08);\n}\n\n.goal-text.completed {\n  opacity: 0.6;\n  text-decoration: line-through;\n}\n\n.goal-status-tag {\n  font-size: 0.7em;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background-color: var(--dialog-color);\n  color: var(--bg-dark);\n  font-weight: bold;\n}\n\n/* ÊÉÖÊä•Á¢éÁâá */\n.intel-item {\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n  background-color: var(--bg-medium);\n  padding: 12px;\n  border-radius: 8px;\n  margin-bottom: 8px;\n  border-left: 3px solid transparent;\n  transition: all 0.2s ease;\n}\n\n.intel-item:last-child {\n  margin-bottom: 0;\n}\n\n.intel-item.empty {\n  text-align: center;\n  color: var(--text-color);\n  opacity: 0.6;\n  padding: 16px;\n  justify-content: center;\n  border-left: none;\n}\n\n.intel-item.Â∑≤ÂÆåÊàê {\n  border-left-color: var(--dialog-color);\n  background-color: rgba(80, 250, 123, 0.08);\n}\n\n.intel-item.Â∑≤Êé¢Á¥¢ {\n  border-left-color: var(--accent-blue);\n  background-color: rgba(189, 147, 249, 0.08);\n}\n\n.intel-item.Êú™Êé¢Á¥¢ {\n  border-left-color: var(--text-color);\n  opacity: 0.7;\n}\n\n/* ËøõÂ∫¶ÁéØ */\n.intel-status-ring {\n  width: 36px;\n  height: 36px;\n  flex-shrink: 0;\n  position: relative;\n}\n\n.progress-ring {\n  width: 100%;\n  height: 100%;\n  transform: rotate(-90deg);\n}\n\n.ring-bg {\n  fill: none;\n  stroke: var(--bg-dark);\n  stroke-width: 2;\n}\n\n.ring-progress {\n  fill: none;\n  stroke-width: 2;\n  stroke-linecap: round;\n  transition: stroke-dasharray 0.3s ease;\n}\n\n.ring-progress.Â∑≤ÂÆåÊàê {\n  stroke: var(--dialog-color);\n}\n\n.ring-progress.Â∑≤Êé¢Á¥¢ {\n  stroke: var(--accent-blue);\n}\n\n.ring-progress.Êú™Êé¢Á¥¢ {\n  stroke: var(--text-color);\n  opacity: 0.5;\n}\n\n.ring-icon {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  font-size: 0.75em;\n  font-weight: bold;\n}\n\n.intel-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.intel-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 6px;\n}\n\n.intel-id {\n  font-weight: bold;\n  color: var(--accent-gold);\n  font-size: 0.9em;\n}\n\n.intel-status-badge {\n  font-size: 0.7em;\n  padding: 2px 8px;\n  border-radius: 4px;\n  font-weight: bold;\n}\n\n.intel-status-badge.Êú™Êé¢Á¥¢ {\n  color: var(--text-color);\n  background-color: var(--bg-dark);\n}\n\n.intel-status-badge.Â∑≤Êé¢Á¥¢ {\n  color: var(--bg-dark);\n  background-color: var(--accent-blue);\n}\n\n.intel-status-badge.Â∑≤ÂÆåÊàê {\n  color: var(--bg-dark);\n  background-color: var(--dialog-color);\n}\n\n.intel-desc {\n  font-size: 0.85em;\n  color: var(--text-color);\n  margin-bottom: 8px;\n  line-height: 1.4;\n}\n\n.intel-meta {\n  display: flex;\n  gap: 12px;\n  font-size: 0.75em;\n  flex-wrap: wrap;\n}\n\n.intel-value {\n  color: var(--accent-gold);\n}\n\n.intel-risk {\n  color: var(--accent-red);\n}\n\n.intel-deadline {\n  color: var(--text-color);\n  opacity: 0.75;\n}\n</style>\n","<template>\n  <section id=\"shelter-section\" class=\"section\">\n    <h2 class=\"section-title\">üè∞ Â∫áÊä§ÊâÄ‰ø°ÊÅØ üè∞</h2>\n    <div class=\"shelter-grid\">\n      <div class=\"shelter-item\">\n        <div class=\"label\">\n          ‚öúÔ∏è Â∫áÊä§ÊâÄÁ≠âÁ∫ß\n          <span v-if=\"isNewShelterLevel\" class=\"new-tag\">NEW</span>\n        </div>\n        <div class=\"value\">{{ store.data.Â∫áÊä§ÊâÄ.Â∫áÊä§ÊâÄÁ≠âÁ∫ß }}</div>\n      </div>\n      <div class=\"shelter-item\">\n        <div class=\"label\">\n          üé≤ ‰ªäÊó•ÊäïÊé∑ÁÇπÊï∞\n          <span v-if=\"isNewDailyRoll\" class=\"new-tag\">NEW</span>\n        </div>\n        <div class=\"value\">{{ store.data.Â∫áÊä§ÊâÄ.‰ªäÊó•ÊäïÊé∑ÁÇπÊï∞ }}</div>\n        <button class=\"roll-calibrate-btn\" :disabled=\"isCalibrating\" @click=\"calibrateDailyRollDate\">\n          üìÖ Ê†°ÂáÜÊó•ÊúüÂíårollÁÇπ\n        </button>\n      </div>\n      <div class=\"shelter-item distance-item\">\n        <div class=\"label\">‚è≥ Ë∑ùÁ¶ª‰∏ãÊ¨°‰øùÂ∫ïÂçáÁ∫ß</div>\n        <div class=\"value\">{{ store.data.Â∫áÊä§ÊâÄ.Ë∑ùÁ¶ª‰∏äÊ¨°ÂçáÁ∫ß }}</div>\n      </div>\n      <div class=\"shelter-item\">\n        <div class=\"label\">üîí ÂèØÊâ©Â±ïÂå∫ÂüüÁä∂ÊÄÅ</div>\n        <div class=\"expansion-list\">\n          <div class=\"expansion-card\" :class=\"{ unlocked: store.data.Â∫áÊä§ÊâÄ.ÂèØÊâ©Â±ïÂå∫Âüü.ÂåªÁñóÁøº !== 'Êú™Ëß£ÈîÅ' }\">\n            <div class=\"name\">‚öïÔ∏è ÂåªÁñóÁøº</div>\n            <div class=\"status\">{{ store.data.Â∫áÊä§ÊâÄ.ÂèØÊâ©Â±ïÂå∫Âüü.ÂåªÁñóÁøº }}</div>\n          </div>\n          <div class=\"expansion-card\" :class=\"{ unlocked: store.data.Â∫áÊä§ÊâÄ.ÂèØÊâ©Â±ïÂå∫Âüü.Âà∂ÈÄ†Â∑•Âùä !== 'Êú™Ëß£ÈîÅ' }\">\n            <div class=\"name\">üîß Âà∂ÈÄ†Â∑•Âùä</div>\n            <div class=\"status\">{{ store.data.Â∫áÊä§ÊâÄ.ÂèØÊâ©Â±ïÂå∫Âüü.Âà∂ÈÄ†Â∑•Âùä }}</div>\n          </div>\n          <div class=\"expansion-card\" :class=\"{ unlocked: store.data.Â∫áÊä§ÊâÄ.ÂèØÊâ©Â±ïÂå∫Âüü.ËΩΩÂÖ∑Ê†ºÁ∫≥Â∫ì !== 'Êú™Ëß£ÈîÅ' }\">\n            <div class=\"name\">üöú ËΩΩÂÖ∑Ê†ºÁ∫≥Â∫ì</div>\n            <div class=\"status\">{{ store.data.Â∫áÊä§ÊâÄ.ÂèØÊâ©Â±ïÂå∫Âüü.ËΩΩÂÖ∑Ê†ºÁ∫≥Â∫ì }}</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- ‰ºäÁî∏Á©∫Èó¥Âú∞Âõæ -->\n      <div class=\"shelter-item\">\n        <div class=\"label\">üó∫Ô∏è ‰ºäÁî∏Á©∫Èó¥Âú∞Âõæ</div>\n        <button class=\"map-toggle-btn\" @click=\"isMapExpanded = !isMapExpanded\">\n          <span class=\"toggle-icon\">{{ isMapExpanded ? '‚ñº' : '‚ñ∂' }}</span>\n          <span class=\"toggle-text\">{{ isMapExpanded ? 'Êî∂Ëµ∑Âú∞Âõæ' : 'Â±ïÂºÄÂú∞Âõæ' }}</span>\n        </button>\n        <button class=\"map-toggle-btn\" :disabled=\"!canOpenScopeEditor\" @click=\"toggleScopeEditor\">\n          <span class=\"toggle-icon\">{{ isScopeEditorOpen ? '‚úï' : '‚ûï' }}</span>\n          <span class=\"toggle-text\">\n            üõ°Ô∏è ËÆæÁΩÆÂ∫áÊä§ËåÉÂõ¥Ôºà20Â±Ç {{ scope20Max ? `${scope20Count}/${scope20Max}` : 'Êú™Ëß£ÈîÅ' }}Ôºå19Â±Ç\n            {{ scope19Max ? `${scope19Count}/${scope19Max}` : 'Êú™Ëß£ÈîÅ' }}Ôºâ\n          </span>\n        </button>\n        <div v-if=\"canOpenScopeEditor && !isScopeEditorOpen\" class=\"scope-hint\">\n          ÂΩìÂâçÁ≠âÁ∫ßËé∑ÂæóÂçáÁ∫ßÂ∫áÊä§ËåÉÂõ¥ÊùÉÈôêÔºåÁÇπÂáªÊü•Áúã\n        </div>\n\n        <div v-show=\"isMapExpanded\" class=\"map-container\">\n          <!-- ÁéÑÂÖ≥Âå∫Âüü -->\n          <div class=\"map-zone\">\n            <div class=\"zone-label\">üö™ ÁéÑÂÖ≥ - ÂáÄÂåñÂå∫</div>\n            <div class=\"room-grid entrance-grid\">\n              <div class=\"room-cell highlight\" :class=\"{ occupied: hasPurifyZoneUser }\">\n                <div class=\"room-number\">ÁéÑÂÖ≥</div>\n                <div class=\"room-value\">{{ getEntranceStatus() }}</div>\n                <div class=\"room-resident\">{{ getPurifyZoneNames() }}</div>\n              </div>\n              <div class=\"room-cell\" :class=\"{ occupied: hasTempGuestA }\">\n                <div class=\"room-number\">‰∏¥Êó∂ÂÆ¢Êàø A</div>\n                <div class=\"room-value\">{{ hasTempGuestA ? 'Â∑≤ÂÖ•‰Ωè' : 'Á©∫ÁΩÆ' }}</div>\n                <div class=\"room-resident\">{{ getTempGuestNames('A') }}</div>\n              </div>\n              <div class=\"room-cell\" :class=\"{ occupied: hasTempGuestB }\">\n                <div class=\"room-number\">‰∏¥Êó∂ÂÆ¢Êàø B</div>\n                <div class=\"room-value\">{{ hasTempGuestB ? 'Â∑≤ÂÖ•‰Ωè' : 'Á©∫ÁΩÆ' }}</div>\n                <div class=\"room-resident\">{{ getTempGuestNames('B') }}</div>\n              </div>\n            </div>\n          </div>\n\n          <!-- Ê†∏ÂøÉÂå∫ -->\n          <div class=\"map-zone\">\n            <div class=\"zone-label\">üíé Ê†∏ÂøÉÁîüÊ¥ªÂå∫</div>\n            <div class=\"room-grid core-grid\">\n              <div class=\"room-cell highlight\" :class=\"{ occupied: hasLivingRoomUser }\">\n                <div class=\"room-number\">ÂÆ¢ÂéÖ</div>\n                <div class=\"room-value\">ÂÖ¨ÂÖ±Âå∫Âüü</div>\n                <div class=\"room-resident\">{{ getLivingRoomNames() }}</div>\n              </div>\n              <div class=\"room-cell highlight\" :class=\"{ occupied: hasKitchenUser }\">\n                <div class=\"room-number\">È§êÂéÖ/Âé®Êàø</div>\n                <div class=\"room-value\">‰∏áË±°ÂêàÊàêÁªàÁ´Ø</div>\n                <div class=\"room-resident\">{{ getKitchenNames() }}</div>\n              </div>\n              <div class=\"room-cell\" :class=\"{ occupied: hasBedroomUser }\">\n                <div class=\"room-number\">‰∏ªÂçßÂÆ§</div>\n                <div class=\"room-value\">{{ hasBedroomUser ? '‰ΩøÁî®‰∏≠' : 'Á©∫Èó≤' }}</div>\n                <div class=\"room-resident\">{{ getBedroomUserNames() }}</div>\n              </div>\n              <div class=\"room-cell\" :class=\"{ occupied: hasBathroomUser }\">\n                <div class=\"room-number\">‰∏ªÊµ¥ÂÆ§</div>\n                <div class=\"room-value\">{{ hasBathroomUser ? '‰ΩøÁî®‰∏≠' : 'Á©∫Èó≤' }}</div>\n                <div class=\"room-resident\">{{ getBathroomUserNames() }}</div>\n              </div>\n            </div>\n          </div>\n\n          <!-- 20Â±ÇËµ∞Âªä -->\n          <div class=\"map-zone\">\n            <div class=\"zone-label\">üè¢ 20Â±Ç - ÂÖ¨ÂØìËµ∞Âªä</div>\n            <div class=\"zone-scope-hint\">{{ scope20Hint }}</div>\n            <div class=\"floor-indicator\">‚Üì ÈÄöÂæÄÂ§ñÈÉ®Ê•ºÊ¢Ø</div>\n            <div class=\"room-grid floor-grid\">\n              <div\n                v-for=\"room in floor20Rooms\"\n                :key=\"room.number\"\n                class=\"room-cell\"\n                :class=\"{\n                  'user-room': room.number === '2001',\n                  occupied: hasFloorResident('20', room.number),\n                  sheltered: isFloorRoomSheltered('20', room.number),\n                  'scope-editable': isScopeEditorOpen && canEditFloor('20') && room.number !== '2001',\n                }\"\n                @click=\"onFloorRoomClick('20', room.number)\"\n              >\n                <div\n                  v-if=\"isScopeEditorOpen && canEditFloor('20') && room.number !== '2001'\"\n                  class=\"scope-badge\"\n                  :class=\"{ on: isFloorRoomSheltered('20', room.number) }\"\n                >\n                  üõ°Ô∏è\n                </div>\n                <div class=\"room-number\">{{ room.number }}</div>\n                <div class=\"room-value\">{{ getFloorRoomStatus('20', room.number) }}</div>\n                <div class=\"room-resident\">{{ getFloorRoomNames('20', room.number) }}</div>\n              </div>\n            </div>\n          </div>\n\n          <!-- 19Â±ÇËµ∞Âªä -->\n          <div class=\"map-zone\">\n            <div class=\"zone-label\">üè¢ 19Â±Ç - ÂÖ¨ÂØìËµ∞Âªä</div>\n            <div class=\"zone-scope-hint\">{{ scope19Hint }}</div>\n            <div class=\"room-grid floor-grid\">\n              <div\n                v-for=\"room in floor19Rooms\"\n                :key=\"room.number\"\n                class=\"room-cell\"\n                :class=\"{\n                  occupied: hasFloorResident('19', room.number),\n                  sheltered: isFloorRoomSheltered('19', room.number),\n                  'scope-editable': isScopeEditorOpen && canEditFloor('19'),\n                }\"\n                @click=\"onFloorRoomClick('19', room.number)\"\n              >\n                <div\n                  v-if=\"isScopeEditorOpen && canEditFloor('19')\"\n                  class=\"scope-badge\"\n                  :class=\"{ on: isFloorRoomSheltered('19', room.number) }\"\n                >\n                  üõ°Ô∏è\n                </div>\n                <div class=\"room-number\">{{ room.number }}</div>\n                <div class=\"room-value\">{{ getFloorRoomStatus('19', room.number) }}</div>\n                <div class=\"room-resident\">{{ getFloorRoomNames('19', room.number) }}</div>\n              </div>\n            </div>\n            <div class=\"floor-indicator\">‚Üì ÈÄöÂæÄ18Â±Ç</div>\n          </div>\n        </div>\n\n        <!-- Â∫áÊä§ËåÉÂõ¥Âø´ÈÄüËÆæÁΩÆÔºö‰∏ç‰æùËµñÂú∞ÂõæÁÇπÈÄâÔºåÈÅøÂÖç‚ÄúÈÄâÂÆåËøòË¶ÅÊªöÂä®ÊâæÊåâÈíÆ‚Äù -->\n        <Teleport to=\"body\">\n          <div\n            v-if=\"isScopeEditorOpen\"\n            class=\"scope-modal-mask\"\n            :style=\"scopeModalMaskStyle\"\n            @click.self=\"closeScopeEditor\"\n          >\n            <div class=\"scope-modal\" role=\"dialog\" aria-modal=\"true\">\n              <div class=\"scope-modal-header\">\n                <div class=\"scope-modal-title\">üõ°Ô∏è ËÆæÁΩÆÁîüÂ≠òÂ∫áÊä§ËåÉÂõ¥</div>\n                <button class=\"scope-icon-btn\" type=\"button\" aria-label=\"ÂÖ≥Èó≠\" @click=\"closeScopeEditor\">‚úï</button>\n              </div>\n\n              <div class=\"scope-modal-subtitle\">\n                ÁÇπÂáªÊàøÈó¥Âç°ÁâáÂç≥ÂèØÊ∑ªÂä†/ÁßªÈô§ÔºõËÆæÁΩÆÂÆåÊàêÂêéÁÇπÂáª‚ÄúÁ°ÆÂÆöÂπ∂ÂèëÈÄÅ‚ÄùÂç≥ÂèØÂêåÊ≠•Áªô‰ºäÁî∏„ÄÇ\n              </div>\n\n              <div class=\"scope-modal-stats\">\n                <div class=\"stat\">\n                  20Â±ÇÔºö<span class=\"stat-strong\">{{ scope20Max ? `${scope20Count}/${scope20Max}` : 'Êú™Ëß£ÈîÅ' }}</span>\n                </div>\n                <div class=\"stat\">\n                  19Â±ÇÔºö<span class=\"stat-strong\">{{ scope19Max ? `${scope19Count}/${scope19Max}` : 'Êú™Ëß£ÈîÅ' }}</span>\n                </div>\n                <button class=\"scope-link-btn\" type=\"button\" @click=\"clearScopeSelection\">Ê∏ÖÁ©∫ÈÄâÊã©</button>\n              </div>\n\n              <div class=\"scope-modal-body\">\n                <div class=\"scope-floor\">\n                  <div class=\"scope-floor-title\">20Â±ÇÔºàÂÖ¨ÂØìËµ∞ÂªäÔºâ</div>\n                  <div class=\"scope-room-grid\">\n                    <button\n                      v-for=\"room in floor20Rooms\"\n                      :key=\"`s20-${room.number}`\"\n                      type=\"button\"\n                      class=\"scope-room-chip\"\n                      :class=\"{\n                        selected: isFloorRoomSheltered('20', room.number),\n                        disabled: !!getToggleRoomDisabledReason('20', room.number),\n                        core: room.number === '2001',\n                      }\"\n                      @click=\"toggleRoomFromSelector('20', room.number)\"\n                    >\n                      <div class=\"chip-top\">\n                        <span class=\"chip-number\">{{ room.number }}</span>\n                        <span class=\"chip-mark\">\n                          {{ isFloorRoomSheltered('20', room.number) ? '‚úì' : '+' }}\n                        </span>\n                      </div>\n                      <div class=\"chip-sub\">\n                        {{ room.number === '2001' ? 'Â∫áÊä§ÊâÄÊú¨‰Ωì' : getFloorRoomStatus('20', room.number) }}\n                      </div>\n                    </button>\n                  </div>\n                </div>\n\n                <div class=\"scope-floor\" :class=\"{ locked: !scope19Max }\">\n                  <div class=\"scope-floor-title\">19Â±ÇÔºàÂÖ¨ÂØìËµ∞ÂªäÔºâ</div>\n                  <div v-if=\"!scope19Max\" class=\"scope-locked-hint\">Â∫áÊä§ÊâÄÁ≠âÁ∫ß 6 Ëß£ÈîÅ</div>\n                  <div class=\"scope-room-grid\" :class=\"{ disabled: !scope19Max }\">\n                    <button\n                      v-for=\"room in floor19Rooms\"\n                      :key=\"`s19-${room.number}`\"\n                      type=\"button\"\n                      class=\"scope-room-chip\"\n                      :class=\"{\n                        selected: isFloorRoomSheltered('19', room.number),\n                        disabled: !!getToggleRoomDisabledReason('19', room.number),\n                      }\"\n                      @click=\"toggleRoomFromSelector('19', room.number)\"\n                    >\n                      <div class=\"chip-top\">\n                        <span class=\"chip-number\">{{ room.number }}</span>\n                        <span class=\"chip-mark\">\n                          {{ isFloorRoomSheltered('19', room.number) ? '‚úì' : '+' }}\n                        </span>\n                      </div>\n                      <div class=\"chip-sub\">{{ getFloorRoomStatus('19', room.number) }}</div>\n                    </button>\n                  </div>\n                </div>\n\n                <details class=\"scope-details\" open>\n                  <summary>È¢ÑËßàÂèëÈÄÅÊñáÊú¨ÔºàË∞ÉËØïÁî®Ôºâ</summary>\n                  <textarea\n                    v-model=\"scopeInstructionDraft\"\n                    class=\"scope-preview scope-preview--editable\"\n                    placeholder=\"(Â∞öÊú™ÈÄâÊã©‰ªª‰ΩïÊàøÈó¥)\"\n                    rows=\"6\"\n                    @input=\"onScopeInstructionInput\"\n                  />\n                  <div class=\"scope-preview-actions\">\n                    <button\n                      class=\"scope-btn scope-btn--ghost scope-btn--mini\"\n                      type=\"button\"\n                      :disabled=\"!scopeInstructionDirty\"\n                      @click=\"resetScopeInstructionDraft\"\n                    >\n                      ÈáçÁΩÆ‰∏∫Ëá™Âä®ÁîüÊàê\n                    </button>\n                    <span class=\"scope-preview-hint\">ÁºñËæëÂêéÔºå‚ÄúÁ°ÆÂÆöÂπ∂ÂèëÈÄÅ‚Äù‰ºöÂèëÈÄÅ‰Ω†‰øÆÊîπÁöÑÊñáÊú¨„ÄÇ</span>\n                  </div>\n                </details>\n              </div>\n\n              <div class=\"scope-modal-footer\">\n                <div class=\"scope-footer-hint\">\n                  ÁÇπÂáª\"Á°ÆÂÆöÂπ∂ÂèëÈÄÅ\"ÂêéÔºåAIÊ≠£Êñá‰ºöËØÜÂà´ÊàøÈó¥ÁöÑÂ∫áÊä§ÊïàÊûúÔºõËã•Âè™ÂãæÈÄâ\"ÊÅ¢Â§çÂÅ•Â∫∑\"ÔºåÂàô‰ªÖÂçïÁ∫ØÊÅ¢Â§çÂÅ•Â∫∑ÂÄº„ÄÇ\n                </div>\n                <div class=\"scope-footer-spacer\"></div>\n                <button class=\"scope-btn\" type=\"button\" @click=\"closeScopeEditor\">ÂÖ≥Èó≠</button>\n                <button class=\"scope-btn scope-btn--primary\" type=\"button\" @click=\"confirmAndSendScope\">\n                  Á°ÆÂÆöÂπ∂ÂèëÈÄÅ\n                </button>\n              </div>\n            </div>\n          </div>\n        </Teleport>\n      </div>\n\n      <!-- Â∫áÊä§ÊâÄËÉΩÂäõÂàóË°®ÔºàÂèØÊäòÂè†Ôºâ -->\n      <div class=\"shelter-item\">\n        <button class=\"collapse-toggle-btn\" @click=\"toggleAbilityExpanded()\">\n          <span class=\"toggle-icon\">{{ isAbilityExpanded ? '‚ñº' : '‚ñ∂' }}</span>\n          <span class=\"toggle-text\">\n            üí° Â∫áÊä§ÊâÄËÉΩÂäõÂàóË°®\n            <span v-if=\"isNewAbilityList\" class=\"new-tag\">NEW</span>\n          </span>\n        </button>\n        <div v-show=\"isAbilityExpanded\" class=\"ability-list\">\n          <template v-if=\"abilities.length > 0\">\n            <div v-for=\"(ab, idx) in abilities\" :key=\"idx\" class=\"ability-card\">\n              <div class=\"name\">\n                {{ ab.name }}\n                <span v-if=\"isNewAbilityItem(ab.name)\" class=\"new-tag new-tag--small\">NEW</span>\n              </div>\n              <div class=\"desc\">{{ ab.desc }}</div>\n            </div>\n          </template>\n          <template v-else>(ÊöÇÊó†ËÉΩÂäõ)</template>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, watch, onUnmounted } from 'vue';\nimport { useDataStore } from '../../store';\nimport { useShelterScopeStore } from '../../shelterScopeStore';\nimport { floorRoomCapacity, isRoomSheltered } from '../../../util/shelter_scope';\nimport { CHAT_VAR_KEYS, copyText, sendToChat } from '../../outbound';\n\nconst store = useDataStore();\nconst scopeStore = useShelterScopeStore();\nconst currentMessageId = Number(getCurrentMessageId());\n\nfunction readShelterUpgradeMeta(worldDate: string): {\n  last_roll_date: string;\n  last_roll_message_id: number;\n  last_level_message_id: number;\n  last_ability_message_id: number;\n  last_roll_source: string;\n  last_ability_changed: boolean;\n  last_roll_event_id: string;\n  last_roll_settled: boolean;\n  last_ability_event_id: string;\n  last_ability_added_names: string[];\n} {\n  try {\n    const vars = typeof getVariables === 'function' ? (getVariables({ type: 'chat' }) ?? {}) : {};\n    const raw = _.get(vars, CHAT_VAR_KEYS.EDEN_SHELTER_UPGRADE, {}) ?? {};\n    const rollHistory = (raw as any)?.roll_history ?? {};\n    const entry = worldDate && rollHistory && typeof rollHistory === 'object' ? (rollHistory as any)[worldDate] : null;\n    return {\n      last_roll_date: String((raw as any)?.last_roll_date ?? '').trim(),\n      // v2: roll NEW ÁªëÂÆöÂà∞ roll_history[Êó•Êúü].message_idÔºàÊØî message_hash ÈîöÁÇπÊõ¥Á®≥ÂÆöÔºâ\n      last_roll_message_id: Number((entry as any)?.message_id ?? (raw as any)?.last_roll_message_id ?? 0) || 0,\n      last_level_message_id: Number((raw as any)?.last_level_message_id ?? 0) || 0,\n      last_ability_message_id: Number((raw as any)?.last_ability_message_id ?? 0) || 0,\n      last_roll_source: String((raw as any)?.last_roll_source ?? '').trim(),\n      last_ability_changed: (raw as any)?.last_ability_changed === true,\n      last_roll_event_id: String((raw as any)?.last_roll_event_id ?? '').trim(),\n      last_roll_settled: (raw as any)?.last_roll_settled === true,\n      last_ability_event_id: String((raw as any)?.last_ability_event_id ?? '').trim(),\n      last_ability_added_names: Array.isArray((raw as any)?.last_ability_added_names)\n        ? (raw as any).last_ability_added_names.map((x: any) => String(x ?? '').trim()).filter(Boolean)\n        : [],\n    };\n  } catch {\n    return {\n      last_roll_date: '',\n      last_roll_message_id: 0,\n      last_level_message_id: 0,\n      last_ability_message_id: 0,\n      last_roll_source: '',\n      last_ability_changed: false,\n      last_roll_event_id: '',\n      last_roll_settled: false,\n      last_ability_event_id: '',\n      last_ability_added_names: [],\n    };\n  }\n}\n\nconst worldDate = computed(() => String((store.data as any)?.‰∏ñÁïå?.Êó•Êúü ?? '').trim());\nconst shelterMeta = computed(() => readShelterUpgradeMeta(worldDate.value));\nfunction readShelterUiSeen(): { roll_event_id: string; ability_event_id: string } {\n  try {\n    const vars = typeof getVariables === 'function' ? (getVariables({ type: 'chat' }) ?? {}) : {};\n    const ui = _.get(vars, 'eden.ui.seen', {}) ?? {};\n    return {\n      roll_event_id: String((ui as any)?.shelter_roll_event_id ?? '').trim(),\n      ability_event_id: String((ui as any)?.shelter_ability_event_id ?? '').trim(),\n    };\n  } catch {\n    return { roll_event_id: '', ability_event_id: '' };\n  }\n}\n\nconst seen = readShelterUiSeen();\n\nfunction markShelterUiSeen(next: Partial<{ roll_event_id: string; ability_event_id: string }>) {\n  if (typeof updateVariablesWith !== 'function') return;\n  updateVariablesWith(\n    (vars: any) => {\n      const base = _.get(vars, 'eden.ui.seen', {}) ?? {};\n      const merged = base && typeof base === 'object' && !Array.isArray(base) ? { ...(base as any) } : {};\n      if (typeof next.roll_event_id === 'string' && next.roll_event_id)\n        merged.shelter_roll_event_id = next.roll_event_id;\n      if (typeof next.ability_event_id === 'string' && next.ability_event_id)\n        merged.shelter_ability_event_id = next.ability_event_id;\n      _.set(vars, 'eden.ui.seen', merged);\n      return vars;\n    },\n    { type: 'chat' },\n  );\n}\n\nconst isNewDailyRoll = computed(\n  () =>\n    !!worldDate.value &&\n    worldDate.value === shelterMeta.value.last_roll_date &&\n    shelterMeta.value.last_roll_source !== 'seed' &&\n    shelterMeta.value.last_roll_settled === true &&\n    !!shelterMeta.value.last_roll_event_id &&\n    shelterMeta.value.last_roll_event_id !== seen.roll_event_id,\n);\nconst isNewShelterLevel = computed(\n  () =>\n    Number.isFinite(currentMessageId) &&\n    currentMessageId > 0 &&\n    currentMessageId === shelterMeta.value.last_level_message_id,\n);\nconst isNewAbilityList = computed(\n  () =>\n    !!worldDate.value &&\n    worldDate.value === shelterMeta.value.last_roll_date &&\n    shelterMeta.value.last_ability_changed === true &&\n    !!shelterMeta.value.last_ability_event_id &&\n    shelterMeta.value.last_ability_event_id !== seen.ability_event_id,\n);\n\nif (isNewDailyRoll.value) {\n  markShelterUiSeen({ roll_event_id: shelterMeta.value.last_roll_event_id });\n}\n\nconst addedAbilitySet = computed(() => new Set(shelterMeta.value.last_ability_added_names));\nfunction isNewAbilityItem(name: string): boolean {\n  const n = String(name ?? '').trim();\n  if (!n) return false;\n  if (!isNewAbilityList.value) return false;\n  return addedAbilitySet.value.has(n);\n}\n\nfunction toggleAbilityExpanded() {\n  const next = !isAbilityExpanded.value;\n  isAbilityExpanded.value = next;\n  if (next && isNewAbilityList.value) {\n    markShelterUiSeen({ ability_event_id: shelterMeta.value.last_ability_event_id });\n  }\n}\n// ÈªòËÆ§ÊäòÂè†Ôºå‰øùÊåÅÂéüÊúâ‰∫§‰∫í\nconst isMapExpanded = ref(false);\nconst isAbilityExpanded = ref(false);\nconst isScopeEditorOpen = ref(false);\nconst scopeModalViewportTop = ref(0);\nconst scopeModalViewportHeight = ref(0);\nlet parentScrollTarget: HTMLElement | Window | null = null;\nconst isCalibrating = ref(false);\n\nasync function calibrateDailyRollDate() {\n  if (isCalibrating.value) return;\n  isCalibrating.value = true;\n  try {\n    const today = String(store.data.‰∏ñÁïå.Êó•Êúü ?? '').trim();\n    if (!today) {\n      toastr?.warning?.('Êó†Ê≥ïÊ†°ÂáÜÔºöÂΩìÂâçÊ•ºÂ±ÇÊ≤°Êúâ‰∏ñÁïåÊó•Êúü', 'ÊØèÊó•Roll');\n      return;\n    }\n\n    const message_id = Number(getCurrentMessageId());\n    if (!Number.isFinite(message_id)) {\n      toastr?.warning?.('Êó†Ê≥ïÊ†°ÂáÜÔºöÊú™ËÉΩËé∑ÂèñÂΩìÂâçÊ•ºÂ±ÇÂè∑', 'ÊØèÊó•Roll');\n      return;\n    }\n\n    // ÊâãÂä®‚ÄúÊúÄÂêé‰øùÂ∫ï‚ÄùÔºöÂè™ÂèëËµ∑ËØ∑Ê±ÇÔºåÂÆûÈôÖÁªìÁÆóÔºàÂê´roll/ÂçáÁ∫ß/Ë°•ÂÖ®ÔºâÁî±ÂêéÂè∞ËÑöÊú¨Áªü‰∏ÄÂ§ÑÁêÜ\n    if (typeof updateVariablesWith === 'function') {\n      const request = {\n        id: `${Date.now()}_${Math.random().toString(16).slice(2)}`,\n        message_id,\n        today,\n        ts: new Date().toISOString(),\n      };\n      updateVariablesWith(\n        (vars: any) => {\n          const raw = _.get(vars, CHAT_VAR_KEYS.EDEN_SHELTER_UPGRADE, {});\n          const next = raw && typeof raw === 'object' && !Array.isArray(raw) ? { ...(raw as any) } : {};\n          next.manual_request = request;\n          _.set(vars, CHAT_VAR_KEYS.EDEN_SHELTER_UPGRADE, next);\n          return vars;\n        },\n        { type: 'chat' },\n      );\n    }\n\n    // Ëß¶Âèë‰∏ÄÊ¨° MVU Êõ¥Êñ∞‰∫ã‰ª∂ÔºåËÆ©ÂêéÂè∞ËÑöÊú¨Á´ãÂàªÂ§ÑÁêÜÔºàÂ∞ΩÈáè‰∏çÊîπÂä®Ê•ºÂ±ÇÂèòÈáèÂÜÖÂÆπÔºâ\n    await waitGlobalInitialized('Mvu');\n    const mvu_data = Mvu.getMvuData({ type: 'message', message_id }) as any;\n    await Mvu.replaceMvuData(mvu_data, { type: 'message', message_id });\n\n    toastr?.info?.('Â∑≤ËØ∑Ê±ÇÊ†°ÂáÜ/rollÔºåÊ≠£Âú®Âà∑Êñ∞‚Ä¶', 'ÊØèÊó•Roll');\n    try {\n      reloadIframe();\n    } catch {\n      window.location.reload();\n    }\n  } catch (e) {\n    console.error('[eden/shelter_calibrate_roll_date] failed', e);\n    toastr?.error?.('Ê†°ÂáÜÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', 'ÊØèÊó•Roll');\n  } finally {\n    isCalibrating.value = false;\n  }\n}\n\nconst scopeModalMaskStyle = computed(() => ({\n  top: `${scopeModalViewportTop.value}px`,\n  height: `${scopeModalViewportHeight.value}px`,\n}));\n\nfunction getParentScrollContainer(frameEl: HTMLElement): HTMLElement | Window {\n  try {\n    const doc = frameEl.ownerDocument;\n    const win = doc.defaultView ?? window.parent;\n    let cur: HTMLElement | null = frameEl.parentElement;\n    while (cur) {\n      const style = win.getComputedStyle(cur);\n      const overflowY = style.overflowY;\n      if ((overflowY === 'auto' || overflowY === 'scroll') && cur.scrollHeight > cur.clientHeight + 1) {\n        return cur;\n      }\n      cur = cur.parentElement;\n    }\n    return win;\n  } catch {\n    return window.parent;\n  }\n}\n\nfunction updateScopeModalViewport() {\n  const frameEl = window.frameElement as HTMLElement | null;\n  if (!frameEl) return;\n  const parentWin = window.parent as Window | null;\n  if (!parentWin) return;\n\n  // ÂÖ≥ÈîÆÔºöÊ∂àÊÅØ iframe Êú¨Ë∫´ÈÄöÂ∏∏‚ÄúÊ≤°ÊúâÂÜÖÈÉ®ÊªöÂä®‚ÄùÔºåÂ§ñÂ±ÇÊªöÂä®ÂèëÁîüÂú®Áà∂Á∫ßÂÆπÂô®„ÄÇ\n  // Âõ∫ÂÆöÂÆö‰Ωç‰ºöÈîöÂÆöÂà∞ iframe È°∂ÈÉ®ÔºåÂØºËá¥Áî®Êà∑Âú®ÈïøÊ≠£Êñá‰∏≠ÁÇπÂºÄÂºπÁ™óÊó∂‚ÄúÂºπÁ™óË∑ëÂà∞ÂæàËøú‚Äù„ÄÇ\n  // Âõ†Ê≠§Êàë‰ª¨Êää mask ÊîæÂà∞ÊñáÊ°£ÁöÑ‚ÄúÂΩìÂâçÂèØËßÅÂå∫ÂüüÂØπÂ∫îÁöÑ y ÂùêÊ†á‚Äù‰∏äÔºàÁªùÂØπÂÆö‰ΩçÔºâ„ÄÇ\n  const rect = frameEl.getBoundingClientRect(); // Áõ∏ÂØπÁà∂Á™óÂè£ viewport\n  const topInIframeDoc = Math.max(0, -rect.top);\n  scopeModalViewportTop.value = topInIframeDoc;\n  scopeModalViewportHeight.value = Math.max(0, parentWin.innerHeight);\n}\n\nfunction bindParentScrollSync() {\n  const frameEl = window.frameElement as HTMLElement | null;\n  if (!frameEl) return;\n  parentScrollTarget = getParentScrollContainer(frameEl);\n  const handler = updateScopeModalViewport;\n\n  if (parentScrollTarget instanceof Window) {\n    parentScrollTarget.addEventListener('scroll', handler, { passive: true });\n    parentScrollTarget.addEventListener('resize', handler, { passive: true });\n  } else {\n    parentScrollTarget.addEventListener('scroll', handler, { passive: true });\n    window.parent?.addEventListener?.('resize', handler, { passive: true });\n  }\n}\n\nfunction unbindParentScrollSync() {\n  const handler = updateScopeModalViewport;\n  if (parentScrollTarget instanceof Window) {\n    parentScrollTarget.removeEventListener('scroll', handler as any);\n    parentScrollTarget.removeEventListener('resize', handler as any);\n  } else if (parentScrollTarget) {\n    parentScrollTarget.removeEventListener('scroll', handler as any);\n    window.parent?.removeEventListener?.('resize', handler as any);\n  }\n  parentScrollTarget = null;\n}\n\nconst shelterLevel = computed(() => {\n  const lv = Number(store.data.Â∫áÊä§ÊâÄ.Â∫áÊä§ÊâÄÁ≠âÁ∫ß);\n  return Number.isFinite(lv) ? lv : 1;\n});\n\nconst canOpenScopeEditor = computed(() => shelterLevel.value >= 3);\n\nconst scope20Max = computed(() => floorRoomCapacity(shelterLevel.value, '20'));\nconst scope19Max = computed(() => floorRoomCapacity(shelterLevel.value, '19'));\nconst scope20Count = computed(() => (scopeStore.scope['20'] ?? []).length);\nconst scope19Count = computed(() => (scopeStore.scope['19'] ?? []).length);\n\nconst scopeInstructionText = computed(() => scopeStore.buildInstructionText());\nconst scopeInstructionDraft = ref('');\nconst scopeInstructionDirty = ref(false);\n\nfunction resetScopeInstructionDraft() {\n  scopeInstructionDraft.value = scopeInstructionText.value;\n  scopeInstructionDirty.value = false;\n}\n\nfunction onScopeInstructionInput() {\n  scopeInstructionDirty.value = true;\n}\n\nfunction buildFloorScopeHint(rooms: string[], max: number, unlockLevel: number): string {\n  if (!max) return `Â∫áÊä§ËåÉÂõ¥Êú™Ëß£ÈîÅÔºàÂ∫áÊä§ÊâÄÁ≠âÁ∫ß${unlockLevel}Ëß£ÈîÅÔºâ„ÄÇÂΩìÂâçÂèØÁî®Â∫áÊä§ 0/0„ÄÇ`;\n  const list = rooms.length ? rooms.join('„ÄÅ') : 'Êó†';\n  return `‰ºäÁî∏Â∑≤Â∫áÊä§${list}„ÄÇÂΩìÂâçÂèØÁî®Â∫áÊä§ ${rooms.length}/${max}„ÄÇ`;\n}\n\nconst scope20Hint = computed(() => buildFloorScopeHint(scopeStore.scope['20'] ?? [], scope20Max.value, 3));\nconst scope19Hint = computed(() => buildFloorScopeHint(scopeStore.scope['19'] ?? [], scope19Max.value, 6));\n\nconst abilities = computed(() => {\n  const raw = store.data.Â∫áÊä§ÊâÄ.Â∫áÊä§ÊâÄËÉΩÂäõ as any;\n  if (Array.isArray(raw)) return raw;\n  return Object.entries(raw ?? {}).map(([name, val]) => ({\n    name,\n    desc: (val as any)?.desc ?? '',\n  }));\n});\n\n// 20Â±ÇÊàøÈó¥Êï∞ÊçÆ\nconst floor20Rooms = [\n  { number: '2001' },\n  { number: '2002' },\n  { number: '2003' },\n  { number: '2004' },\n  { number: '2005' },\n  { number: '2006' },\n  { number: '2007' },\n  { number: '2008' },\n  { number: '2009' },\n  { number: '2010' },\n  { number: '2011' },\n  { number: '2012' },\n];\n\n// 19Â±ÇÊàøÈó¥Êï∞ÊçÆ\nconst floor19Rooms = [\n  { number: '1901' },\n  { number: '1902' },\n  { number: '1903' },\n  { number: '1904' },\n  { number: '1905' },\n  { number: '1906' },\n  { number: '1907' },\n  { number: '1908' },\n  { number: '1909' },\n  { number: '1910' },\n  { number: '1911' },\n  { number: '1912' },\n];\n\nfunction canEditFloor(floor: '20' | '19'): boolean {\n  return scopeStore.canEditFloor(floor, shelterLevel.value);\n}\n\nfunction isFloorRoomSheltered(floor: '20' | '19', roomNumber: string): boolean {\n  // 2001ÔºàÂ∫áÊä§ÊâÄÊú¨‰ΩìÔºâ‰ª•ÂèäÂ∫áÊä§ÊâÄÂÜÖÈÉ®Âå∫ÂüüÈªòËÆ§ÂèóÂ∫áÊä§Ôºö‰∏çÈúÄË¶ÅËÆæÁΩÆÔºå‰πü‰∏çÂç†Áî®‚ÄúÂ∫áÊä§ÂêçÈ¢ù‚Äù„ÄÇ\n  if (floor === '20' && roomNumber === '2001') return true;\n  return isRoomSheltered(scopeStore.scope, floor, roomNumber);\n}\n\nfunction toggleScopeEditor() {\n  if (!canOpenScopeEditor.value) {\n    toastr.warning('Â∫áÊä§ËåÉÂõ¥ÂäüËÉΩÂú®Â∫áÊä§ÊâÄÁ≠âÁ∫ß 3 Ëß£ÈîÅ');\n    return;\n  }\n  isScopeEditorOpen.value = !isScopeEditorOpen.value;\n}\n\nfunction closeScopeEditor() {\n  isScopeEditorOpen.value = false;\n}\n\nwatch(isScopeEditorOpen, open => {\n  if (open) {\n    resetScopeInstructionDraft();\n    updateScopeModalViewport();\n    bindParentScrollSync();\n    return;\n  }\n  unbindParentScrollSync();\n});\n\nonUnmounted(() => {\n  unbindParentScrollSync();\n});\n\nwatch(scopeInstructionText, text => {\n  if (!isScopeEditorOpen.value) return;\n  if (scopeInstructionDirty.value) return;\n  scopeInstructionDraft.value = text;\n});\n\nfunction clearScopeSelection() {\n  const ok = window.confirm('Á°ÆÂÆöÊ∏ÖÁ©∫Â∑≤ÈÄâÊã©ÁöÑÂ∫áÊä§ÊàøÈó¥Ôºü');\n  if (!ok) return;\n  scopeStore.clearAll();\n  toastr.info('Â∑≤Ê∏ÖÁ©∫');\n}\n\nfunction getToggleRoomDisabledReason(floor: '20' | '19', roomNumber: string): string | null {\n  if (floor === '20' && roomNumber === '2001') return '2001/Â∫áÊä§ÊâÄÂÜÖÈÉ®Âå∫ÂüüÈªòËÆ§‰∏∫ÂèóÂ∫áÊä§Ôºå‰∏çÂç†Áî®ÂêçÈ¢ù„ÄÅÊó†ÈúÄËÆæÁΩÆ';\n  if (!canEditFloor(floor)) return `ÂΩìÂâçÁ≠âÁ∫ßÊú™Ëß£ÈîÅ${floor}Â±ÇÂ∫áÊä§ËåÉÂõ¥`;\n\n  const max = floor === '20' ? scope20Max.value : scope19Max.value;\n  const count = floor === '20' ? scope20Count.value : scope19Count.value;\n  const selected = isFloorRoomSheltered(floor, roomNumber);\n  if (!selected && max > 0 && count >= max) return `ËØ•Ê•ºÂ±ÇÂ∫áÊä§ËåÉÂõ¥Â∑≤Ëææ‰∏äÈôêÔºà${max} Èó¥Ôºâ`;\n  return null;\n}\n\nfunction toggleRoomFromSelector(floor: '20' | '19', roomNumber: string) {\n  const reason = getToggleRoomDisabledReason(floor, roomNumber);\n  if (reason) {\n    toastr.warning(reason);\n    return;\n  }\n  const res = scopeStore.toggleRoom(floor, roomNumber, shelterLevel.value);\n  if (!res.ok) toastr.warning(res.reason ?? 'Êó†Ê≥ï‰øÆÊîπÂ∫áÊä§ËåÉÂõ¥');\n}\n\nfunction onFloorRoomClick(floor: '20' | '19', roomNumber: string) {\n  if (!isScopeEditorOpen.value) return;\n  if (floor === '20' && roomNumber === '2001') {\n    toastr.info('2001 ‰∏∫Â∫áÊä§ÊâÄÊú¨‰ΩìÔºåÊó†ÈúÄËÆæÁΩÆÂ∫áÊä§');\n    return;\n  }\n  const res = scopeStore.toggleRoom(floor, roomNumber, shelterLevel.value);\n  if (!res.ok) toastr.warning(res.reason ?? 'Êó†Ê≥ï‰øÆÊîπÂ∫áÊä§ËåÉÂõ¥');\n}\n\nasync function copyScopeInstruction() {\n  await copyText(scopeInstructionDraft.value, { toast: true });\n}\n\nfunction sendScopeInstruction() {\n  sendToChat(scopeInstructionDraft.value, {\n    toast: true,\n    successMessage: 'Â∑≤ÂèëÈÄÅ',\n    failureMessage: 'ÂèëÈÄÅÂ§±Ë¥•ÔºåËØ∑Â§çÂà∂ÂêéÊâãÂä®ÂèëÈÄÅ',\n    unavailableMessage: 'Êó†Ê≥ïÂèëÈÄÅÔºötriggerSlash ‰∏çÂèØÁî®',\n  });\n}\n\nfunction confirmAndSendScope() {\n  const text = scopeInstructionDraft.value.trim();\n  if (!text) {\n    toastr.warning('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂ∫áÊä§ÁöÑÊàøÈó¥');\n    return;\n  }\n\n  const res = sendToChat(text, {\n    toast: true,\n    successMessage: 'Â∑≤ÂèëÈÄÅÂà∞ËÅäÂ§©',\n    failureMessage: 'ÂèëÈÄÅÂ§±Ë¥•ÔºåÂ∑≤Â∞ùËØïÂ§çÂà∂ÔºåËØ∑ÊâãÂä®ÂèëÈÄÅ',\n    unavailableMessage: 'Êó†Ê≥ïÁõ¥Êé•ÂèëÈÄÅÔºåÂ∑≤Â∞ùËØïÂ§çÂà∂ÔºåËØ∑ÊâãÂä®ÂèëÈÄÅ',\n  });\n\n  if (res.ok) {\n    closeScopeEditor();\n    return;\n  }\n\n  void copyText(text, { toast: false });\n}\n\n// ÁéÑÂÖ≥Âå∫ÂüüËÆ°ÁÆóÂ±ûÊÄß\nconst hasTempGuestA = computed(() => store.data.ÊàøÈó¥.ÁéÑÂÖ≥.‰∏¥Êó∂ÂÆ¢ÊàøAÂÖ•‰ΩèËÄÖ.length > 0);\n\nconst hasTempGuestB = computed(() => store.data.ÊàøÈó¥.ÁéÑÂÖ≥.‰∏¥Êó∂ÂÆ¢ÊàøBÂÖ•‰ΩèËÄÖ.length > 0);\n\nconst hasPurifyZoneUser = computed(() => store.data.ÊàøÈó¥.ÁéÑÂÖ≥.ÂáÄÂåñÈöîÁ¶ªÂå∫ÂÖ•‰ΩèËÄÖ.length > 0);\n\nfunction getTempGuestNames(room: 'A' | 'B'): string {\n  const names = room === 'A' ? store.data.ÊàøÈó¥.ÁéÑÂÖ≥.‰∏¥Êó∂ÂÆ¢ÊàøAÂÖ•‰ΩèËÄÖ : store.data.ÊàøÈó¥.ÁéÑÂÖ≥.‰∏¥Êó∂ÂÆ¢ÊàøBÂÖ•‰ΩèËÄÖ;\n  return names.length > 0 ? names.join('„ÄÅ') : '-';\n}\n\nfunction getPurifyZoneNames(): string {\n  const names = store.data.ÊàøÈó¥.ÁéÑÂÖ≥.ÂáÄÂåñÈöîÁ¶ªÂå∫ÂÖ•‰ΩèËÄÖ;\n  return names.length > 0 ? names.join('„ÄÅ') : '-';\n}\n\nfunction getEntranceStatus(): string {\n  // ÁéÑÂÖ≥ÊÄªÊòØÊòæÁ§∫\"Â∞±Áª™\"\n  return 'Â∞±Áª™';\n}\n\n// Ê†∏ÂøÉÂå∫ËÆ°ÁÆóÂ±ûÊÄß\nconst hasLivingRoomUser = computed(() => store.data.ÊàøÈó¥.Ê†∏ÂøÉÂå∫.ÂÆ¢ÂéÖ‰ΩøÁî®ËÄÖ.length > 0);\n\nconst hasKitchenUser = computed(() => store.data.ÊàøÈó¥.Ê†∏ÂøÉÂå∫.È§êÂéÖÂé®Êàø‰ΩøÁî®ËÄÖ.length > 0);\n\nfunction getLivingRoomNames(): string {\n  const names = store.data.ÊàøÈó¥.Ê†∏ÂøÉÂå∫.ÂÆ¢ÂéÖ‰ΩøÁî®ËÄÖ;\n  return names.length > 0 ? names.join('„ÄÅ') : '-';\n}\n\nfunction getKitchenNames(): string {\n  const names = store.data.ÊàøÈó¥.Ê†∏ÂøÉÂå∫.È§êÂéÖÂé®Êàø‰ΩøÁî®ËÄÖ;\n  return names.length > 0 ? names.join('„ÄÅ') : '-';\n}\n\nconst hasBedroomUser = computed(() => store.data.ÊàøÈó¥.Ê†∏ÂøÉÂå∫.‰∏ªÂçßÂÆ§‰ΩøÁî®ËÄÖ.length > 0);\n\nconst hasBathroomUser = computed(() => store.data.ÊàøÈó¥.Ê†∏ÂøÉÂå∫.‰∏ªÊµ¥ÂÆ§‰ΩøÁî®ËÄÖ.length > 0);\n\nfunction getBedroomUserNames(): string {\n  const names = store.data.ÊàøÈó¥.Ê†∏ÂøÉÂå∫.‰∏ªÂçßÂÆ§‰ΩøÁî®ËÄÖ;\n  return names.length > 0 ? names.join('„ÄÅ') : '-';\n}\n\nfunction getBathroomUserNames(): string {\n  const names = store.data.ÊàøÈó¥.Ê†∏ÂøÉÂå∫.‰∏ªÊµ¥ÂÆ§‰ΩøÁî®ËÄÖ;\n  return names.length > 0 ? names.join('„ÄÅ') : '-';\n}\n\n// Ê•ºÂ±ÇÊàøÈó¥ËæÖÂä©ÂáΩÊï∞\nfunction getFloorRoomData(floor: string, room: string) {\n  const floorKey = floor === '20' ? 'Ê•ºÂ±Ç20ÊàøÈó¥' : 'Ê•ºÂ±Ç19ÊàøÈó¥';\n  const rooms = store.data.ÊàøÈó¥.Ê•ºÂ±ÇÊàøÈó¥[floorKey as keyof typeof store.data.ÊàøÈó¥.Ê•ºÂ±ÇÊàøÈó¥];\n  return rooms?.[room] || { ÂÖ•‰ΩèËÄÖ: [] };\n}\n\nfunction hasFloorResident(floor: string, room: string): boolean {\n  return getFloorRoomData(floor, room).ÂÖ•‰ΩèËÄÖ.length > 0;\n}\n\nfunction getFloorRoomStatus(floor: string, room: string): string {\n  const data = getFloorRoomData(floor, room);\n  return data.ÂÖ•‰ΩèËÄÖ.length > 0 ? 'Â∑≤ÂÖ•‰Ωè' : 'Á©∫ÁΩÆ';\n}\n\nfunction getFloorRoomNames(floor: string, room: string): string {\n  const data = getFloorRoomData(floor, room);\n  if (data.ÂÖ•‰ΩèËÄÖ.length === 0) return '-';\n\n  // ÁâπÊÆäÊàøÈó¥Ôºö1901 Âõ∫ÂÆöÂÆ∂Â∫≠ÔºàÈÅøÂÖç AI/ÂèòÈáèÊ≥¢Âä®ÂØºËá¥ UI ÊòæÁ§∫‰∏çÁ®≥ÂÆöÔºâ\n  if (room === '1901') return 'Áà±ÂÆ´ÈìÉ & Áà±ÂÆ´ÂøÉÁà±';\n\n  return formatRoomResidents(data.ÂÖ•‰ΩèËÄÖ, { maxShown: room === '2001' ? 3 : 4, showTotal: room === '2001' });\n}\n\nfunction normalizeResidentName(name: any): string {\n  const s = String(name ?? '').trim();\n  if (!s) return '';\n  // UI ÊòæÁ§∫ÔºöÂ∞ÜÈÖíÈ¶ÜÂèòÈáèÂç†‰ΩçÁ¨¶Êò†Â∞Ñ‰∏∫‚Äú‰Ω†‚Äù\n  if (s === '{{user}}') return '‰Ω†';\n  return s;\n}\n\nfunction formatRoomResidents(\n  rawNames: any,\n  opts?: {\n    maxShown?: number;\n    showTotal?: boolean;\n  },\n): string {\n  const maxShown = Math.max(1, Number(opts?.maxShown ?? 4));\n  const showTotal = opts?.showTotal === true;\n\n  const names = (Array.isArray(rawNames) ? rawNames : [])\n    .map(normalizeResidentName)\n    .filter((n: string) => n.length > 0);\n  if (names.length === 0) return '-';\n\n  // ËÆ©‚Äú‰Ω†‚Äù‰ºòÂÖàÊòæÁ§∫Âú®ÊúÄÂâçÈù¢\n  const unique = _(names).uniq().value();\n  const hasYou = unique.includes('‰Ω†');\n  const ordered = hasYou ? ['‰Ω†', ...unique.filter(n => n !== '‰Ω†')] : unique;\n\n  const shown = ordered.slice(0, maxShown);\n  const hidden = Math.max(0, ordered.length - shown.length);\n\n  const base = hidden > 0 ? `${shown.join('„ÄÅ')}‚Ä¶(+${hidden})` : shown.join('„ÄÅ');\n  return showTotal && ordered.length >= 2 ? `${base}Ôºà${ordered.length}Ôºâ` : base;\n}\n</script>\n\n<style scoped>\n.roll-calibrate-btn {\n  margin-top: 8px;\n  width: 100%;\n  padding: 8px 10px;\n  border-radius: 10px;\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(255, 255, 255, 0.06);\n  color: var(--text-color);\n  cursor: pointer;\n  font-size: 0.85em;\n}\n\n.roll-calibrate-btn:disabled {\n  opacity: 0.55;\n  cursor: not-allowed;\n}\n\n.new-tag {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 6px;\n  padding: 1px 6px;\n  border-radius: 999px;\n  font-size: 0.72em;\n  font-weight: 800;\n  letter-spacing: 0.02em;\n  color: #fff;\n  background: rgba(229, 57, 53, 0.9);\n  border: 1px solid rgba(255, 255, 255, 0.12);\n}\n\n.new-tag--small {\n  margin-left: 8px;\n  padding: 0 6px;\n  font-size: 0.68em;\n  line-height: 1.4;\n  opacity: 0.95;\n}\n\n.distance-item .label {\n  /* ‰øùÊåÅ DOM ÁªìÊûÑ‰∏çÂä®ÔºåÂè™‰øÆÊ≠£ÊñáÊ°àÔºàÈÅøÂÖçÂõ†ÁºñÁ†Å/Ë°®ÊÉÖÁ¨¶Âè∑ÂØºËá¥ÁöÑË°•‰∏ÅÂåπÈÖçÈóÆÈ¢òÔºâ */\n  position: relative;\n  color: transparent;\n}\n\n.distance-item .label::after {\n  content: '‚è≥ Ë∑ùÁ¶ª‰∏äÊ¨°‰øùÂ∫ïÂçáÁ∫ß';\n  position: absolute;\n  inset: 0;\n  color: var(--text-color);\n  pointer-events: none;\n}\n\n.scope-hint {\n  margin: 2px 0 10px;\n  font-size: 0.85em;\n  color: var(--accent-cyan, #00b4d8);\n  opacity: 0.9;\n}\n\n.scope-btn {\n  padding: 8px 10px;\n  border-radius: 8px;\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  background-color: rgba(255, 255, 255, 0.06);\n  color: var(--text-color);\n  cursor: pointer;\n  font-size: 0.9em;\n}\n\n.scope-btn--primary {\n  border-color: rgba(0, 180, 216, 0.55);\n  background-color: rgba(0, 180, 216, 0.18);\n  color: #e8fbff;\n  font-weight: 600;\n}\n\n.scope-btn--ghost {\n  background-color: transparent;\n}\n\n.scope-preview {\n  margin-top: 10px;\n  padding: 10px 12px;\n  border-radius: 8px;\n  background-color: rgba(0, 0, 0, 0.25);\n  color: var(--text-color);\n  font-size: 0.9em;\n  line-height: 1.4;\n  word-break: break-word;\n}\n\n.scope-preview--editable {\n  display: block;\n  width: 100%;\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  outline: none;\n  resize: vertical;\n  min-height: 92px;\n  font-family: inherit;\n}\n\n.scope-preview--editable:focus {\n  border-color: rgba(0, 180, 216, 0.55);\n  box-shadow: 0 0 0 2px rgba(0, 180, 216, 0.2);\n}\n\n.scope-preview-actions {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  margin-top: 8px;\n  flex-wrap: wrap;\n}\n\n.scope-preview-hint {\n  font-size: 0.8em;\n  opacity: 0.85;\n}\n\n.scope-btn--mini {\n  padding: 6px 10px;\n  font-size: 0.85em;\n}\n\n/* --- Â∫áÊä§ËåÉÂõ¥ÔºöÂø´ÈÄüËÆæÁΩÆÂºπÁ™ó --- */\n.scope-modal-mask {\n  position: absolute;\n  left: 0;\n  right: 0;\n  z-index: 50;\n  background: rgba(0, 0, 0, 0.55);\n  padding-top: calc(12px + env(safe-area-inset-top));\n  padding-right: calc(12px + env(safe-area-inset-right));\n  padding-bottom: calc(12px + env(safe-area-inset-bottom));\n  padding-left: calc(12px + env(safe-area-inset-left));\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.scope-modal {\n  width: min(560px, calc(100% - 8px));\n  max-height: calc(100% - 8px);\n  background: rgba(25, 28, 35, 0.98);\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  border-radius: 14px;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.45);\n  display: flex;\n  flex-direction: column;\n}\n\n.scope-modal-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 12px 8px;\n}\n\n.scope-modal-title {\n  font-weight: 700;\n  color: var(--text-strong, #f1fa8c);\n}\n\n.scope-icon-btn {\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(255, 255, 255, 0.06);\n  color: var(--text-color);\n  border-radius: 10px;\n  padding: 6px 10px;\n  cursor: pointer;\n}\n\n.scope-modal-subtitle {\n  padding: 0 12px 8px;\n  font-size: 0.9em;\n  opacity: 0.92;\n}\n\n.scope-modal-stats {\n  display: flex;\n  gap: 10px;\n  padding: 0 12px 10px;\n  flex-wrap: wrap;\n  align-items: center;\n}\n\n.scope-modal-stats .stat {\n  padding: 6px 10px;\n  border-radius: 999px;\n  background: rgba(255, 255, 255, 0.06);\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  font-size: 0.85em;\n}\n\n.stat-strong {\n  color: var(--accent-cyan, #00b4d8);\n  font-weight: 700;\n}\n\n.scope-link-btn {\n  margin-left: auto;\n  border: none;\n  background: transparent;\n  color: var(--accent-cyan, #00b4d8);\n  font-size: 0.85em;\n  cursor: pointer;\n  padding: 6px 8px;\n  opacity: 0.95;\n}\n\n.scope-link-btn:hover {\n  opacity: 1;\n}\n\n.scope-modal-body {\n  padding: 0 12px 12px;\n  overflow-y: auto;\n}\n\n.scope-floor + .scope-floor {\n  margin-top: 14px;\n}\n\n.scope-floor-title {\n  font-weight: 700;\n  margin-bottom: 8px;\n}\n\n.scope-locked-hint {\n  font-size: 0.85em;\n  opacity: 0.8;\n  margin: -4px 0 8px;\n}\n\n.scope-room-grid {\n  display: grid;\n  grid-template-columns: repeat(4, minmax(0, 1fr));\n  gap: 8px;\n}\n\n.scope-room-grid.disabled {\n  opacity: 0.55;\n}\n\n.scope-room-chip {\n  text-align: left;\n  border-radius: 12px;\n  padding: 10px 10px 8px;\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  background: rgba(255, 255, 255, 0.06);\n  color: var(--text-color);\n  cursor: pointer;\n  min-height: 56px;\n}\n\n.scope-room-chip .chip-top {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 6px;\n}\n\n.scope-room-chip .chip-number {\n  font-weight: 800;\n}\n\n.scope-room-chip .chip-mark {\n  width: 22px;\n  height: 22px;\n  border-radius: 999px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(255, 255, 255, 0.08);\n  border: 1px solid rgba(255, 255, 255, 0.12);\n  font-weight: 800;\n  opacity: 0.85;\n}\n\n.scope-room-chip .chip-sub {\n  margin-top: 6px;\n  font-size: 0.8em;\n  opacity: 0.9;\n}\n\n.scope-room-chip.selected {\n  border-color: rgba(241, 250, 140, 0.6);\n  background: radial-gradient(\n    circle at 30% 20%,\n    rgba(241, 250, 140, 0.18),\n    rgba(241, 250, 140, 0.06) 55%,\n    rgba(255, 255, 255, 0.04)\n  );\n}\n\n.scope-room-chip.selected .chip-mark {\n  background: rgba(241, 250, 140, 0.18);\n  border-color: rgba(241, 250, 140, 0.6);\n}\n\n.scope-room-chip.core {\n  border-color: rgba(241, 250, 140, 0.35);\n  background: rgba(241, 250, 140, 0.06);\n}\n\n.scope-room-chip.disabled {\n  opacity: 0.55;\n}\n\n.zone-scope-hint {\n  margin: 6px 0 10px;\n  padding: 6px 10px;\n  border-radius: 10px;\n  border: 1px solid rgba(241, 250, 140, 0.18);\n  background: rgba(241, 250, 140, 0.05);\n  color: rgba(241, 250, 140, 0.92);\n  font-size: 0.8em;\n  line-height: 1.3;\n}\n\n.scope-details {\n  margin-top: 14px;\n  border-top: 1px dashed rgba(255, 255, 255, 0.12);\n  padding-top: 10px;\n}\n\n.scope-details summary {\n  cursor: pointer;\n  opacity: 0.9;\n}\n\n.scope-modal-footer {\n  padding: 10px 12px 12px;\n  border-top: 1px solid rgba(255, 255, 255, 0.1);\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  align-items: center;\n}\n\n.scope-footer-hint {\n  flex: 1 1 100%;\n  order: -1;\n  margin-bottom: 4px;\n  padding: 8px 12px;\n  border-radius: 6px;\n  background: linear-gradient(135deg, rgba(255, 180, 80, 0.12), rgba(255, 140, 0, 0.08));\n  border: 1px solid rgba(255, 180, 80, 0.25);\n  font-size: 0.8em;\n  color: rgba(255, 220, 150, 0.95);\n  line-height: 1.4;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.scope-footer-hint::before {\n  content: 'üí°';\n  font-size: 1.1em;\n}\n\n.scope-footer-spacer {\n  flex: 1;\n}\n\n.room-cell {\n  position: relative;\n  /* ÊôÆÈÄöÁä∂ÊÄÅÔºöÂÜ∑Ëâ≤Ë∞ÉÔºåÊöóÁ§∫Êú™ÂèóÂ∫áÊä§ */\n  border: 1px solid rgba(100, 120, 100, 0.3);\n}\n\n.room-cell.scope-editable {\n  cursor: pointer;\n}\n\n/* ÂèóÂ∫áÊä§Áä∂ÊÄÅÔºöÊ©ôËâ≤/ÈáëËâ≤Ê∏êÂèòÔºåÊöóÁ§∫Ê∏©ÊöñÂÆâÂÖ® */\n.room-cell.sheltered {\n  border: none;\n  outline: 3px solid rgba(255, 160, 60, 0.9);\n  outline-offset: 1px;\n  box-shadow:\n    0 0 0 1px rgba(255, 180, 80, 0.3),\n    0 0 24px rgba(255, 140, 0, 0.4),\n    0 0 48px rgba(255, 100, 0, 0.2),\n    inset 0 0 30px rgba(255, 200, 100, 0.15);\n  background: radial-gradient(\n    ellipse at center,\n    rgba(255, 200, 100, 0.25) 0%,\n    rgba(255, 180, 80, 0.15) 40%,\n    transparent 70%\n  );\n}\n\n.room-cell.sheltered .room-number {\n  color: #ffb347;\n  font-weight: 700;\n  text-shadow: 0 0 8px rgba(255, 180, 80, 0.6);\n}\n\n.room-cell.sheltered .room-number::after {\n  content: ' üõ°Ô∏è';\n  font-size: 0.85em;\n  filter: drop-shadow(0 0 4px rgba(255, 200, 100, 0.8));\n}\n\n.room-cell.sheltered .room-occupants {\n  color: rgba(255, 220, 150, 0.9);\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  .room-cell.sheltered {\n    animation: edenShelterWarmGlow 3s ease-in-out infinite;\n  }\n}\n\n@keyframes edenShelterWarmGlow {\n  0%,\n  100% {\n    box-shadow:\n      0 0 0 1px rgba(255, 180, 80, 0.3),\n      0 0 24px rgba(255, 140, 0, 0.4),\n      0 0 48px rgba(255, 100, 0, 0.2),\n      inset 0 0 30px rgba(255, 200, 100, 0.15);\n  }\n  50% {\n    box-shadow:\n      0 0 0 1px rgba(255, 180, 80, 0.4),\n      0 0 36px rgba(255, 160, 0, 0.5),\n      0 0 60px rgba(255, 120, 0, 0.25),\n      inset 0 0 40px rgba(255, 220, 120, 0.2);\n  }\n}\n\n.scope-badge {\n  position: absolute;\n  top: 6px;\n  right: 6px;\n  font-size: 0.9em;\n  opacity: 0.25;\n  pointer-events: none;\n}\n\n.scope-badge.on {\n  opacity: 1;\n}\n\n@media (max-width: 520px) {\n  .scope-room-grid {\n    grid-template-columns: repeat(3, minmax(0, 1fr));\n  }\n}\n</style>\n","/* Êú´Êó•‰ºäÁî∏Âõ≠Áä∂ÊÄÅÊ†èÔºàiframe ÂâçÁ´ØÁïåÈù¢ÔºâÂÖ®Â±ÄÊ†∑Âºè */\n:root {\n  --bg-main: #1a1b26;\n  --bg-light: #282a36;\n  --bg-medium: #44475a;\n  --bg-dark: #13141b;\n  --border-color: #8be9fd;\n  --border-shadow-color: #b3f2ff;\n  --text-color: #f8f8f2;\n  --text-strong: #ffffff;\n  --dialog-color: #50fa7b;\n  --thought-color: #ff79c6;\n  --accent-gold: #f1fa8c;\n  --accent-red: #ff5555;\n  --accent-blue: #bd93f9;\n  --accent-cyan: #00b4d8;\n  --health-bar-color: #50fa7b;\n  --border-radius: 12px;\n  --section-gap: 16px;\n  --inner-padding: 18px;\n  --transition-speed: 0.3s;\n  --font-main:\n    'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n}\n\n:root[data-theme='jade_green'] {\n  --bg-main: #f0f8f8;\n  --bg-light: #ffffff;\n  --bg-medium: #e0f0e0;\n  --bg-dark: #d0e0d0;\n  --border-color: #20b2aa;\n  --border-shadow-color: #a7dbd8;\n  --text-color: #333333;\n  --text-strong: #000000;\n  --dialog-color: #1e90ff;\n  --thought-color: #6a5acd;\n  --accent-gold: #ffa500;\n  --accent-red: #dc143c;\n  --accent-blue: #4682b4;\n  --accent-cyan: #00b4d8;\n  --health-bar-color: #28a745;\n}\n\n:root[data-theme='parchment'] {\n  --bg-main: #efe3c3;\n  --bg-light: #e8d9b0;\n  --bg-medium: #c3a56e;\n  --bg-dark: #6c4a24;\n  --border-color: #8a6642;\n  --border-shadow-color: #5a3a28;\n  --text-color: #3a2d1f;\n  --text-strong: #000000;\n  --dialog-color: #1e3a8a;\n  --thought-color: #8b0000;\n  --accent-gold: #c19a49;\n  --accent-red: #8b3a3a;\n  --accent-blue: #2c4875;\n  --accent-cyan: #008b8b;\n  --health-bar-color: #d2691e;\n}\n\n:root[data-theme='milky'] {\n  --bg-main: #f5f5f5;\n  --bg-medium: #e8e8e8;\n  --bg-light: #ffffff;\n  --bg-dark: #dcdcdc;\n  --border-color: #79a07b;\n  --border-shadow-color: #c0c0c0;\n  --text-color: #4a4a4a;\n  --text-strong: #000000;\n  --dialog-color: #4682b4;\n  --thought-color: #6a5acd;\n  --accent-gold: #d2b48c;\n  --accent-red: #cd5c5c;\n  --accent-blue: #5f9ea0;\n  --accent-cyan: #20b2aa;\n  --health-bar-color: #8fbc8f;\n}\n\n* {\n  box-sizing: border-box;\n}\n\nhtml,\nbody,\n#app {\n  width: 100%;\n  max-width: 100%;\n}\n\n#app {\n  display: block;\n}\n\nbody {\n  font-family: var(--font-main);\n  margin: 0;\n  padding: 8px;\n  background-color: transparent;\n  color: var(--text-color);\n  line-height: 1.7;\n}\n\nmain {\n  font-size: var(--font-size-main, 16px);\n  border: 1px solid var(--border-color);\n  box-shadow:\n    0 0 25px 0px var(--border-shadow-color),\n    inset 0 0 15px rgba(255, 255, 255, 0.05);\n  background-color: var(--bg-main);\n  padding: 20px;\n  border-radius: var(--border-radius);\n  max-width: 100%;\n  margin: 0;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: var(--section-gap);\n}\n\n.section {\n  background-color: var(--bg-light);\n  padding: var(--inner-padding);\n  border-radius: var(--border-radius);\n  border: 1px solid rgba(200, 200, 220, 0.1);\n  position: relative;\n}\n\n.section-title {\n  font-size: 1.25em;\n  font-weight: bold;\n  color: var(--text-strong);\n  text-align: center;\n  margin: 0 0 16px 0;\n  border-bottom: 2px solid var(--border-color);\n  padding-bottom: 10px;\n}\n\n.choices-title {\n  text-align: left;\n  border-bottom: none;\n  padding-bottom: 0;\n}\n\n.global-info-bar {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 8px;\n}\n\n.info-item {\n  padding: 4px 10px;\n  border-radius: 8px;\n  background-color: var(--bg-medium);\n  font-size: 0.9em;\n  width: 100%;\n  white-space: normal;\n}\n\n.info-item--location {\n  color: var(--accent-blue);\n}\n\n.info-item--date {\n  color: var(--accent-gold);\n}\n\n.info-item--time {\n  color: var(--accent-red);\n}\n\n.content-text {\n  white-space: pre-line;\n  word-break: break-word;\n}\n\n.dialog-text {\n  color: var(--dialog-color);\n  font-weight: 500;\n}\n\n.thought-text {\n  color: var(--thought-color);\n  font-style: italic;\n}\n\n.system-text {\n  color: var(--accent-gold);\n  font-weight: bold;\n  text-shadow: 0 0 5px rgba(241, 250, 140, 0.3);\n  display: inline-block;\n  margin: 4px 0;\n}\n\n.eden-text {\n  color: #00ffff; /* ËµõÂçöÈùí */\n  font-family: 'Courier New', monospace;\n  background: rgba(0, 255, 255, 0.1);\n  padding: 2px 6px;\n  border-radius: 4px;\n  border-left: 2px solid #00ffff;\n  display: block; /* Áã¨Âç†‰∏ÄË°å */\n  margin: 6px 0;\n}\n\n.story-image {\n  max-width: 100%;\n  height: auto;\n  border-radius: 8px;\n  margin: 10px 0;\n  display: block;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);\n}\n\n.shelter-grid {\n  display: grid;\n  grid-template-columns: 1fr;\n  gap: 12px;\n}\n\n.shelter-item .label {\n  font-size: 0.9em;\n  color: var(--text-color);\n  opacity: 0.8;\n  margin-bottom: 6px;\n}\n\n.shelter-item .value {\n  font-size: 1.05em;\n  color: var(--text-strong);\n  white-space: pre-line;\n  word-break: break-word;\n}\n\n.ability-list {\n  max-height: 280px;\n  overflow-y: auto;\n  padding: 10px;\n  background-color: var(--bg-dark);\n  border-radius: 8px;\n}\n\n.ability-card {\n  background-color: var(--bg-medium);\n  padding: 12px;\n  border-radius: 6px;\n  margin-bottom: 8px;\n}\n\n.ability-card .name {\n  font-weight: bold;\n  color: var(--border-color);\n  margin-bottom: 4px;\n}\n\n.ability-card .desc {\n  font-size: 0.85em;\n  opacity: 0.9;\n  line-height: 1.4;\n  white-space: pre-line;\n}\n\n.status-tabs-container {\n  background-color: var(--bg-main);\n  border-radius: var(--border-radius);\n  padding: 10px;\n}\n\n.tab-buttons {\n  display: flex;\n  flex-wrap: nowrap;\n  gap: 8px;\n  margin-bottom: 10px;\n  overflow-x: auto;\n  padding-bottom: 8px;\n}\n\n.tab-button {\n  background-color: var(--bg-medium);\n  color: var(--text-color);\n  padding: 8px 12px;\n  border-radius: 8px;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  cursor: pointer;\n  font-size: 0.9em;\n  white-space: nowrap;\n  transition: all var(--transition-speed);\n}\n\n.tab-button:hover {\n  background-color: var(--border-color);\n  color: var(--bg-dark);\n}\n\n.tab-button.active {\n  background-color: var(--border-color);\n  color: var(--bg-dark);\n  font-weight: bold;\n  box-shadow: 0 0 10px rgba(139, 233, 253, 0.4);\n}\n\n.tab-content {\n  display: none;\n  animation: fadeEffect var(--transition-speed);\n}\n\n.tab-content.active {\n  display: block;\n}\n\n@keyframes fadeEffect {\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n}\n\n.status-grid {\n  display: flex;\n  flex-direction: column;\n  gap: 14px;\n}\n\n.status-item {\n  background-color: var(--bg-light);\n  padding: 12px;\n  border-radius: 10px;\n  border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.status-item .label {\n  font-weight: bold;\n  color: var(--accent-blue);\n  margin-bottom: 6px;\n  font-size: 0.95em;\n}\n\n.status-item .value {\n  color: var(--text-strong);\n  white-space: pre-line;\n  word-break: break-word;\n}\n\n.eden-version {\n  align-self: flex-end;\n  font-size: 0.75em;\n  opacity: 0.6;\n  letter-spacing: 0.02em;\n  margin-top: 2px;\n}\n\n.health-section-header {\n  display: flex;\n  align-items: baseline;\n  justify-content: space-between;\n  gap: 10px;\n}\n\n.health-status-subtext {\n  font-size: 0.85em;\n  opacity: 0.85;\n  margin: 4px 0 10px 0;\n  color: var(--accent-gold);\n}\n\n.value-subtext {\n  font-size: 0.85em;\n  opacity: 0.9;\n  margin-top: 8px;\n  color: var(--accent-red);\n  white-space: pre-line;\n}\n\n.progress-bar-container {\n  width: 100%;\n  height: 12px;\n  background-color: var(--bg-dark);\n  border-radius: 6px;\n  overflow: hidden;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.progress-bar-value {\n  height: 100%;\n  width: 0%;\n  background-color: var(--health-bar-color);\n  border-radius: 6px;\n  transition: width var(--transition-speed);\n}\n\n.details-grid {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 12px;\n}\n\n.other-residents-item {\n  padding: 10px;\n  border-radius: 8px;\n  background-color: var(--bg-medium);\n  margin-bottom: 10px;\n}\n\n.other-residents-item .label {\n  font-weight: bold;\n  color: var(--accent-blue);\n  margin-bottom: 4px;\n}\n\n.other-residents-item .value {\n  white-space: pre-line;\n  word-break: break-word;\n}\n\n.choice-item {\n  width: 100%;\n  text-align: left;\n  background-color: var(--bg-medium);\n  padding: 10px;\n  border-radius: 8px;\n  margin-bottom: 8px;\n  cursor: pointer;\n  transition: all var(--transition-speed);\n  border: 0;\n  color: inherit;\n  font: inherit;\n}\n\n.choice-item:hover {\n  background-color: var(--border-color);\n  color: var(--bg-dark);\n}\n\n.palette-button {\n  position: absolute;\n  top: 16px;\n  right: 16px;\n  width: 38px;\n  height: 38px;\n  border-radius: 50%;\n  border: 1px solid var(--border-color);\n  background: var(--bg-medium);\n  color: var(--text-color);\n  cursor: pointer;\n  font-size: 18px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all var(--transition-speed);\n}\n\n.palette-button:hover {\n  background: var(--border-color);\n  color: var(--bg-dark);\n}\n\n.palette-modal {\n  position: absolute;\n  top: 60px;\n  right: 16px;\n  width: 260px;\n  background: var(--bg-light);\n  border: 1px solid var(--border-color);\n  border-radius: 10px;\n  box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);\n  padding: 14px;\n  display: none;\n  z-index: 50;\n}\n\n.palette-modal.show {\n  display: block;\n}\n\n.palette-modal h3 {\n  margin: 0 0 10px 0;\n  font-size: 1em;\n  color: var(--text-strong);\n}\n\n.palette-option {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.palette-option label {\n  font-size: 0.85em;\n  color: var(--text-color);\n}\n\n.palette-option select {\n  width: 120px;\n  padding: 4px;\n  border-radius: 6px;\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  background: var(--bg-medium);\n  color: var(--text-color);\n}\n\n.palette-buttons {\n  display: flex;\n  justify-content: flex-end;\n}\n\n.palette-buttons button {\n  padding: 6px 10px;\n  border-radius: 8px;\n  border: none;\n  background: var(--border-color);\n  color: var(--bg-dark);\n  cursor: pointer;\n  font-weight: bold;\n}\n\n.palette-buttons button:hover {\n  background: var(--border-shadow-color);\n}\n\n.ability-list::-webkit-scrollbar {\n  width: 8px;\n}\n\n.ability-list::-webkit-scrollbar-track {\n  background: var(--bg-dark);\n  border-radius: 4px;\n}\n\n.ability-list::-webkit-scrollbar-thumb {\n  background-color: var(--border-color);\n  border-radius: 4px;\n  border: 2px solid var(--bg-dark);\n}\n\n.ability-list::-webkit-scrollbar-thumb:hover {\n  background-color: var(--border-shadow-color);\n}\n\n.expansion-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\n  gap: 8px;\n  margin-top: 8px;\n}\n\n.expansion-card {\n  background-color: var(--bg-dark);\n  padding: 10px;\n  border-radius: 8px;\n  text-align: center;\n  border: 1px solid rgba(255, 255, 255, 0.05);\n  opacity: 0.5;\n  transition: all var(--transition-speed);\n}\n\n.expansion-card.unlocked {\n  opacity: 1;\n  border-color: var(--border-color);\n  box-shadow: 0 0 10px rgba(139, 233, 253, 0.1);\n  background-color: var(--bg-medium);\n}\n\n.expansion-card .name {\n  font-size: 0.9em;\n  font-weight: bold;\n  color: var(--text-color);\n  margin-bottom: 4px;\n}\n\n.expansion-card.unlocked .name {\n  color: var(--accent-gold);\n}\n\n.expansion-card .status {\n  font-size: 0.8em;\n  color: var(--accent-red);\n}\n\n.expansion-card.unlocked .status {\n  color: var(--dialog-color);\n}\n\n@media (max-width: 600px) {\n  .details-grid {\n    grid-template-columns: 1fr;\n  }\n\n  main {\n    padding: 12px;\n    margin: 5px auto;\n    font-size: var(--font-size-main, 14px);\n  }\n\n  .tab-button {\n    padding: 6px 10px;\n    font-size: 0.85em;\n  }\n}\n\n/* ===== ÊäòÂè†ÊåâÈíÆÊ†∑Âºè ===== */\n.map-toggle-btn,\n.collapse-toggle-btn {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  width: 100%;\n  padding: 10px 14px;\n  background-color: var(--bg-medium);\n  border: 1px solid var(--border-color);\n  border-radius: 8px;\n  color: var(--text-color);\n  cursor: pointer;\n  font-size: 0.95em;\n  transition: all var(--transition-speed);\n  margin-bottom: 8px;\n}\n\n.map-toggle-btn:hover,\n.collapse-toggle-btn:hover {\n  background-color: var(--border-color);\n  color: var(--bg-dark);\n}\n\n.toggle-icon {\n  font-size: 0.8em;\n  transition: transform var(--transition-speed);\n}\n\n.toggle-text {\n  flex: 1;\n  text-align: left;\n}\n\n.map-container {\n  animation: slideDown var(--transition-speed);\n}\n\n@keyframes slideDown {\n  from {\n    opacity: 0;\n    transform: translateY(-10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.map-zone {\n  margin-bottom: 16px;\n  padding: 12px;\n  background-color: var(--bg-dark);\n  border-radius: 10px;\n  border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.zone-label {\n  font-weight: bold;\n  color: var(--accent-gold);\n  margin-bottom: 10px;\n  font-size: 0.95em;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.floor-indicator {\n  text-align: center;\n  font-size: 0.8em;\n  color: var(--text-color);\n  opacity: 0.6;\n  margin: 8px 0;\n  padding: 4px;\n  border-top: 1px dashed rgba(255, 255, 255, 0.1);\n  border-bottom: 1px dashed rgba(255, 255, 255, 0.1);\n}\n\n.room-grid {\n  display: grid;\n  gap: 6px;\n}\n\n.entrance-grid {\n  grid-template-columns: repeat(3, 1fr);\n}\n\n.core-grid {\n  grid-template-columns: repeat(2, 1fr);\n}\n\n.floor-grid {\n  grid-template-columns: repeat(6, 1fr);\n}\n\n.expansion-grid {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 8px;\n}\n\n.room-cell {\n  background-color: var(--bg-medium);\n  padding: 8px 6px;\n  border-radius: 6px;\n  text-align: center;\n  border: 1px solid rgba(255, 255, 255, 0.05);\n  transition: all var(--transition-speed);\n  min-height: 56px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n\n.room-cell:hover {\n  border-color: var(--border-color);\n  box-shadow: 0 0 8px rgba(139, 233, 253, 0.2);\n}\n\n.room-cell.highlight {\n  background-color: var(--bg-light);\n  border-color: var(--border-color);\n  box-shadow: 0 0 10px rgba(139, 233, 253, 0.15);\n}\n\n.room-cell.user-room {\n  border-color: var(--accent-gold);\n  background-color: rgba(241, 250, 140, 0.1);\n}\n\n.room-cell.user-room .room-number {\n  color: var(--accent-gold);\n}\n\n.room-cell.occupied {\n  border-color: var(--dialog-color);\n  background-color: rgba(80, 250, 123, 0.08);\n}\n\n.room-cell.occupied .room-value {\n  color: var(--dialog-color);\n}\n\n.room-number {\n  font-size: 0.8em;\n  font-weight: bold;\n  color: var(--text-strong);\n  margin-bottom: 4px;\n}\n\n.room-value {\n  font-size: 0.75em;\n  color: var(--accent-blue);\n  margin-bottom: 2px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.room-resident {\n  font-size: 0.7em;\n  color: var(--text-color);\n  opacity: 0.8;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.expansion-cell {\n  background-color: var(--bg-medium);\n  padding: 10px 8px;\n  border-radius: 8px;\n  text-align: center;\n  border: 1px dashed rgba(255, 255, 255, 0.1);\n  opacity: 0.5;\n  transition: all var(--transition-speed);\n}\n\n.expansion-cell.unlocked {\n  opacity: 1;\n  border-style: solid;\n  border-color: var(--border-color);\n  background-color: var(--bg-light);\n}\n\n.expansion-icon {\n  font-size: 1.4em;\n  margin-bottom: 4px;\n}\n\n.expansion-name {\n  font-size: 0.85em;\n  font-weight: bold;\n  color: var(--text-color);\n  margin-bottom: 4px;\n}\n\n.expansion-status {\n  font-size: 0.7em;\n  color: var(--accent-red);\n}\n\n.expansion-cell.unlocked .expansion-status {\n  color: var(--dialog-color);\n}\n\n/* ÂìçÂ∫îÂºèË∞ÉÊï¥ */\n@media (max-width: 600px) {\n  .entrance-grid {\n    grid-template-columns: repeat(3, 1fr);\n  }\n\n  .core-grid {\n    grid-template-columns: repeat(2, 1fr);\n  }\n\n  .floor-grid {\n    grid-template-columns: repeat(4, 1fr);\n  }\n\n  .expansion-grid {\n    grid-template-columns: repeat(3, 1fr);\n  }\n\n  .room-cell {\n    min-height: 48px;\n    padding: 6px 4px;\n  }\n\n  .room-number {\n    font-size: 0.75em;\n  }\n\n  .room-resident {\n    font-size: 0.65em;\n  }\n}\n\n@media (max-width: 400px) {\n  .floor-grid {\n    grid-template-columns: repeat(3, 1fr);\n  }\n\n  .expansion-grid {\n    grid-template-columns: repeat(2, 1fr);\n  }\n}\n"],"names":[],"ignoreList":[],"sourceRoot":""}