{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/寒冬末日/util/room.ts","src://tavern_helper_template/src/寒冬末日/schema.ts","src://tavern_helper_template/src/寒冬末日/脚本/变量结构/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","export type RoomLocation =\n  | { kind: 'entrance'; room: '临时客房A' | '临时客房B' | '玄关' | '净化/隔离区' }\n  | { kind: 'core'; room: '客厅' | '餐厅/厨房' | '主卧室' | '主浴室' }\n  | { kind: 'floor'; floor: string; roomNumber: string }\n  | { kind: 'outdoor'; area: string }\n  | { kind: 'none' };\n\ntype RoomsStatData = any;\n\nexport function normalizeRoomTag(tag: string): string {\n  const raw = String(tag ?? '').trim();\n  if (!raw) return '';\n\n  // 清理误输入的空白（兼容旧存档/手动编辑造成的断行空格）\n  const t = raw.replace(/\\s+/g, '');\n\n  // 兼容旧命名/别名\n  if (t === '核心区/餐厅厨房') return '核心区/餐厅/厨房';\n  if (\n    t === '玄关/隔离区' ||\n    t === '玄关/净化区' ||\n    t === '玄关/净化隔离区' ||\n    t === '玄关/净化/隔离区' ||\n    t === '玄关（净化/隔离区）'\n  )\n    return '玄关/净化/隔离区';\n  if (t.startsWith('室外/')) return `户外/${t.slice('室外/'.length)}`;\n  if (t === '室外') return '户外';\n\n  return t;\n}\n\nexport function parseRoomTag(tag: string): RoomLocation {\n  const t = normalizeRoomTag(tag);\n  if (!t) return { kind: 'none' };\n\n  if (t === '玄关/临时客房A') return { kind: 'entrance', room: '临时客房A' };\n  if (t === '玄关/临时客房B') return { kind: 'entrance', room: '临时客房B' };\n  if (t === '玄关/净化/隔离区') return { kind: 'entrance', room: '净化/隔离区' };\n  if (t === '玄关') return { kind: 'entrance', room: '玄关' };\n\n  if (t === '核心区/主卧室') return { kind: 'core', room: '主卧室' };\n  if (t === '核心区/主浴室') return { kind: 'core', room: '主浴室' };\n  if (t === '核心区/客厅') return { kind: 'core', room: '客厅' };\n  if (t === '核心区/餐厅/厨房') return { kind: 'core', room: '餐厅/厨房' };\n\n  const m = t.match(/^楼层(\\d+)\\/(.+)$/);\n  if (m) {\n    const floor = String(m[1] ?? '').trim();\n    const roomNumber = String(m[2] ?? '').trim();\n    // 严格限制房号为纯数字（避免“2001门外/门口”等不规范字符串进入系统）\n    if (floor && roomNumber && /^\\d{4}$/.test(roomNumber)) return { kind: 'floor', floor, roomNumber };\n  }\n\n  const outdoor = t.match(/^户外\\/(.+)$/);\n  if (outdoor) {\n    const area = String(outdoor[1] ?? '').trim();\n    if (area) return { kind: 'outdoor', area };\n    return { kind: 'outdoor', area: '' };\n  }\n  if (t === '户外') return { kind: 'outdoor', area: '' };\n\n  return { kind: 'none' };\n}\n\nexport function roomTagFromLocation(loc: RoomLocation): string {\n  if (loc.kind === 'entrance') {\n    if (loc.room === '临时客房A') return '玄关/临时客房A';\n    if (loc.room === '临时客房B') return '玄关/临时客房B';\n    if (loc.room === '净化/隔离区') return '玄关/净化/隔离区';\n    return '玄关';\n  }\n  if (loc.kind === 'core') {\n    if (loc.room === '客厅') return '核心区/客厅';\n    if (loc.room === '餐厅/厨房') return '核心区/餐厅/厨房';\n    if (loc.room === '主卧室') return '核心区/主卧室';\n    return '核心区/主浴室';\n  }\n  if (loc.kind === 'floor') return `楼层${loc.floor}/${loc.roomNumber}`;\n  if (loc.kind === 'outdoor') return loc.area ? `户外/${loc.area}` : '户外';\n  return '';\n}\n\nexport function findRoleLocation(rooms: RoomsStatData, roleName: string): RoomLocation {\n  const name = roleName ?? '';\n  if (!name) return { kind: 'none' };\n\n  const entranceA: string[] = _.get(rooms, '玄关.临时客房A入住者', []);\n  if (Array.isArray(entranceA) && entranceA.includes(name)) return { kind: 'entrance', room: '临时客房A' };\n\n  const entranceB: string[] = _.get(rooms, '玄关.临时客房B入住者', []);\n  if (Array.isArray(entranceB) && entranceB.includes(name)) return { kind: 'entrance', room: '临时客房B' };\n\n  const purify: string[] = _.get(rooms, '玄关.净化隔离区入住者', []);\n  if (Array.isArray(purify) && purify.includes(name)) return { kind: 'entrance', room: '净化/隔离区' };\n\n  const bedroom: string[] = _.get(rooms, '核心区.主卧室使用者', []);\n  if (Array.isArray(bedroom) && bedroom.includes(name)) return { kind: 'core', room: '主卧室' };\n\n  const bathroom: string[] = _.get(rooms, '核心区.主浴室使用者', []);\n  if (Array.isArray(bathroom) && bathroom.includes(name)) return { kind: 'core', room: '主浴室' };\n\n  const livingRoom: string[] = _.get(rooms, '核心区.客厅使用者', []);\n  if (Array.isArray(livingRoom) && livingRoom.includes(name)) return { kind: 'core', room: '客厅' };\n\n  const kitchen: string[] = _.get(rooms, '核心区.餐厅厨房使用者', []);\n  if (Array.isArray(kitchen) && kitchen.includes(name)) return { kind: 'core', room: '餐厅/厨房' };\n\n  const floor20: Record<string, any> = _.get(rooms, '楼层房间.楼层20房间', {});\n  if (floor20 && typeof floor20 === 'object') {\n    for (const [roomNumber, data] of Object.entries(floor20)) {\n      const residents: string[] = (data as any)?.入住者 ?? [];\n      if (Array.isArray(residents) && residents.includes(name)) return { kind: 'floor', floor: '20', roomNumber };\n    }\n  }\n\n  const floor19: Record<string, any> = _.get(rooms, '楼层房间.楼层19房间', {});\n  if (floor19 && typeof floor19 === 'object') {\n    for (const [roomNumber, data] of Object.entries(floor19)) {\n      const residents: string[] = (data as any)?.入住者 ?? [];\n      if (Array.isArray(residents) && residents.includes(name)) return { kind: 'floor', floor: '19', roomNumber };\n    }\n  }\n\n  return { kind: 'none' };\n}\n","import { z } from 'zod';\nimport { normalizeRoomTag, parseRoomTag } from './util/room';\n\nconst 主要角色关系档位Schema = z.enum(['无', '拒绝', '交易', '顺从', '忠诚', '性奴']).prefault('无');\nconst 临时NPC关系档位Schema = z.enum(['无', '拒绝', '交易', '顺从', '忠诚', '性奴']).prefault('无');\nconst 关系倾向Schema = z.enum(['极易', '易', '中立', '难', '极难', '不可']).prefault('中立');\nconst 健康状况Schema = z\n  .preprocess(\n    val => {\n      if (typeof val !== 'string') return val;\n      const s = val.trim();\n      if (s === '病重' || s === '濒死' || s === '重病' || s === '病重/濒死') return '重病/濒死';\n      if (s === '生病' || s === '受伤' || s === '生病/受伤' || s === '生病受伤') return '生病/受伤';\n      return s;\n    },\n    z.enum(['健康', '亚健康', '生病/受伤', '重病/濒死', '无', '死亡']),\n  )\n  .prefault('健康');\nconst 登场状态Schema = z.enum(['登场', '离场']).prefault('离场');\nconst 更新原因Schema = z\n  .preprocess(val => {\n    if (val === null || val === undefined) return '';\n    if (typeof val === 'number') return String(val);\n    return val;\n  }, z.string())\n  .prefault('');\n\nconst create角色Schema = (args: {\n  relationStageSchema: z.ZodTypeAny;\n  relationTendencySchema: z.ZodTypeAny;\n  defaultRelationStage: string;\n  defaultRelationTendency: string;\n  defaultImprint: number;\n}) =>\n  z\n    .object({\n      姓名: z.string().prefault(''),\n      关系: args.relationStageSchema.describe('反应角色的性同意程度，受玩家施舍/救助影响小受关系倾向影响大'),\n      关系倾向: args.relationTendencySchema.describe('角色关系的倾向影响Imp数值的变化幅度和难易程度'),\n      秩序刻印: z.coerce\n        .number()\n        .int()\n        .transform(v => _.clamp(v, -20, 100))\n        .prefault(19)\n        .describe('范围-20~100（允许负数）；当Imp<0时将触发角色死亡结算'),\n      秩序刻印更新原因: 更新原因Schema.describe(\n        '跟随Imp值变动，格式示例：+3, 高级设施体验 / -5, 违反等级约束强行提出性要求',\n      ),\n      健康: z.coerce\n        .number()\n        .transform(v => _.clamp(v, 0, 100))\n        .prefault(100)\n        .describe('范围0-100。记录健康数值。获得食物/温暖增加；受伤/饥饿/寒冷减少。'),\n      健康更新原因: 更新原因Schema.describe('记录健康值变化的原因和数值，格式：+/-X, 原因描述'),\n      健康状况: 健康状况Schema.describe('>=80:健康; 60-79:亚健康; 30-59:生病/受伤; <30:重病/濒死'),\n      衣着: z.string().prefault('').describe('描述当前的衣着状态包括上衣裤子丝袜内衣内裤'),\n      舌唇: z.string().prefault('').describe('口腔、嘴唇的状态'),\n      胸乳: z.string().prefault('').describe('胸部的状态或乳房乳头乳晕等在色情挑逗下的反应'),\n      私穴: z.string().prefault('').describe('私处的详细状态或反应'),\n      神态样貌: z.string().prefault('').describe('面部表情和神态'),\n      动作姿势: z.string().prefault('').describe('身体姿态和动作'),\n      内心想法: z.string().prefault('').describe('符合角色身份和剧情描述的第一人称内心独白'),\n      所在房间: z\n        .string()\n        .prefault('')\n        .transform(v => {\n          const t = normalizeRoomTag(v);\n          return parseRoomTag(t).kind === 'none' ? '' : t;\n        })\n        .describe(\n          '角色所在房间（单一真源，用于脚本解算与自动纠偏房间数组）。允许值：\"\"（未知/外出） | 玄关 | 玄关/净化/隔离区 | 玄关/临时客房A | 玄关/临时客房B | 核心区/客厅 | 核心区/餐厅/厨房 | 核心区/主卧室 | 核心区/主浴室 | 楼层{N}/{房间号4位数字}（示例：楼层30/3001） | 户外/{地点}（示例：户外/停车场）。注意：UI 地图仅会显示有格子的地点（玄关/净化/隔离区、玄关/临时客房A/B、核心区四区、以及当前支持的楼层房间）；其它位置（如楼层30/3001、户外/…）暂不展示。',\n        ),\n      登场状态: 登场状态Schema.describe('剧情未提及时离场，剧情提及登场，凡在庇护所内一律默认登场\"'),\n    })\n    .prefault({\n      姓名: '',\n      关系: args.defaultRelationStage,\n      关系倾向: args.defaultRelationTendency,\n      秩序刻印: args.defaultImprint,\n      健康: 100,\n      健康更新原因: '',\n      健康状况: '健康',\n      衣着: '',\n      舌唇: '',\n      胸乳: '',\n      私穴: '',\n      神态样貌: '',\n      动作姿势: '',\n      内心想法: '',\n      所在房间: '',\n      秩序刻印更新原因: '',\n      登场状态: '离场',\n    });\n\nconst 主要角色Schema = create角色Schema({\n  relationStageSchema: 主要角色关系档位Schema,\n  relationTendencySchema: 关系倾向Schema,\n  defaultRelationStage: '无',\n  defaultRelationTendency: '中立',\n  defaultImprint: 0,\n});\n\nconst 临时NPCSchema = create角色Schema({\n  relationStageSchema: 临时NPC关系档位Schema,\n  relationTendencySchema: 关系倾向Schema,\n  defaultRelationStage: '无',\n  defaultRelationTendency: '中立',\n  defaultImprint: 0,\n});\n\nexport const Schema = z\n  .object({\n    世界: z\n      .object({\n        地址: z.string().prefault(''),\n        日期: z.string().prefault(''),\n        时间: z.string().prefault(''),\n        末日天数: z.coerce.number().prefault(0),\n      })\n      .prefault({\n        地址: '',\n        日期: '',\n        时间: '',\n        末日天数: 0,\n      }),\n\n    庇护所: z\n      .object({\n        庇护所等级: z.coerce\n          .number()\n          .transform(v => _.clamp(v, 1, 10))\n          .prefault(1)\n          .describe('等级上限为10。升级来源：1.每日Roll点命中；2.剧情奖励；3.保底触发(7天)。'),\n        今日投掷点数: z\n          .string()\n          .prefault('')\n          .describe(\n            '记录每日升级判定结果。跨天时Roll点(0-10)，命中幸运数(7,10)触发升级。格式：\"今日已投掷: X点 (触发幸运升级！/未升级)\"',\n          ),\n        距离上次升级: z\n          .string()\n          .prefault('')\n          .describe(\n            '记录保底进度。若连续7天未升级，则在第8天跨天时强制触发保底升级。格式：\"X天 | 剩余保底升级天数：Y天\"。升级后重置。',\n          ),\n        庇护所能力: z\n          .record(z.string().describe('能力名'), z.object({ desc: z.string() }).prefault({ desc: '' }))\n          .prefault({})\n          .describe('已激活的庇护所能力列表。包含等级提升奖励与主线任务解锁的特殊奖励。'),\n        可扩展区域: z\n          .object({\n            医疗翼: z.string().prefault('未解锁').describe('等级3:初级医疗舱; 等级6:外科手术台; 等级9:专家级自动医师'),\n            制造工坊: z\n              .string()\n              .prefault('未解锁')\n              .describe(\n                '任务奖励解锁: \"非致命防御制造器\"(阶段一), \"轻型军火熔炉\"(阶段二); 等级5解锁\"伊甸荚舱\"; 等级8解锁\"重型军械库\"',\n              ),\n            载具格纳库: z\n              .string()\n              .prefault('未解锁')\n              .describe('等级7解锁\"先驱者制造单元\"; 阶段三任务解锁\"工业原料合成器\"'),\n          })\n          .prefault({\n            医疗翼: '未解锁',\n            制造工坊: '未解锁',\n            载具格纳库: '未解锁',\n          })\n          .describe('记录庇护所可扩展区域的解锁状态'),\n\n        当前生存庇护范围: z\n          .record(z.string(), z.array(z.string()))\n          .prefault({})\n          .describe('脚本回写镜像：最终生效的生存庇护范围（key: 楼层号，如\"20\"/\"19\"，value: 房间号数组）。AI 只读。'),\n\n        庇护范围变更: z\n          .object({\n            add: z.record(z.string(), z.array(z.string())).optional(),\n            remove: z.record(z.string(), z.array(z.string())).optional(),\n            note: z.string().optional(),\n          })\n          .prefault({})\n          .describe(\n            'AI 写入入口（delta）：用于提交“生存庇护范围”的增删变更，脚本会校验/去重/卡上限后写入 chat 变量并回写镜像。示例：{ add: { \"20\": [\"2002\"] }, remove: { \"20\": [\"2007\"] } }',\n          ),\n      })\n      .prefault({\n        庇护所等级: 1,\n        今日投掷点数: '',\n        距离上次升级: '',\n        庇护所能力: {},\n        可扩展区域: {\n          医疗翼: '未解锁',\n          制造工坊: '未解锁',\n          载具格纳库: '未解锁',\n        },\n        当前生存庇护范围: {},\n        庇护范围变更: {},\n      }),\n\n    房间: z\n      .object({\n        玄关: z\n          .object({\n            净化隔离区入住者: z.array(z.string()).prefault([]).describe('净化/隔离区停留者姓名列表（公共区域）'),\n            临时客房A入住者: z.array(z.string()).prefault([]).describe('临时客房A进入者姓名列表'),\n            临时客房B入住者: z.array(z.string()).prefault([]).describe('临时客房B进入者姓名列表'),\n          })\n          .prefault({\n            净化隔离区入住者: [],\n            临时客房A入住者: [],\n            临时客房B入住者: [],\n          })\n          .describe('玄关区域房间状态'),\n        核心区: z\n          .object({\n            客厅使用者: z.array(z.string()).prefault([]).describe('客厅停留者姓名列表（公共区域）'),\n            餐厅厨房使用者: z.array(z.string()).prefault([]).describe('餐厅/厨房停留者姓名列表（含万象合成终端）'),\n            主卧室使用者: z.array(z.string()).prefault([]).describe('主卧室进入或使用者姓名列表'),\n            主浴室使用者: z.array(z.string()).prefault([]).describe('主浴室进入或使用者姓名列表'),\n          })\n          .prefault({\n            客厅使用者: [],\n            餐厅厨房使用者: [],\n            主卧室使用者: [],\n            主浴室使用者: [],\n          })\n          .describe('20楼2001室核心区域房间进入或使用名单列表'),\n        楼层房间: z\n          .object({\n            楼层20房间: z\n              .record(z.string(), z.object({ 入住者: z.array(z.string()) }).prefault({ 入住者: [] }))\n              .prefault({})\n              .describe('20层各房间进入或使用者列表，key为房间号'),\n            楼层19房间: z\n              .record(z.string(), z.object({ 入住者: z.array(z.string()) }).prefault({ 入住者: [] }))\n              .prefault({})\n              .describe('19层各房间进入或使用者列表，key为房间号'),\n          })\n          .prefault({\n            楼层20房间: {},\n            楼层19房间: {},\n          })\n          .describe('楼层房间状态'),\n      })\n      .prefault({\n        玄关: {\n          净化隔离区入住者: [],\n          临时客房A入住者: [],\n          临时客房B入住者: [],\n        },\n        核心区: {\n          客厅使用者: [],\n          餐厅厨房使用者: [],\n          主卧室使用者: [],\n          主浴室使用者: [],\n        },\n        楼层房间: {\n          楼层20房间: {},\n          楼层19房间: {},\n        },\n      }),\n\n    主线任务: z\n      .object({\n        当前阶段: z.string().prefault('阶段一：秩序的萌芽').describe('主线任务的当前阶段名称'),\n        阶段目标: z\n          .record(\n            z.string(),\n            z.object({\n              描述: z.string(),\n              当前值: z.coerce.number().prefault(0),\n              目标值: z.coerce.number().prefault(1),\n            }),\n          )\n          .prefault({\n            '肃清20、19、21层的敌对幸存者': { 描述: '肃清20、19、21层的敌对幸存者', 当前值: 0, 目标值: 3 },\n            庇护至少3个核心女性角色或家庭: { 描述: '庇护至少3个核心女性角色或家庭', 当前值: 0, 目标值: 3 },\n            完成一个公寓内部的情报碎片任务: { 描述: '完成一个公寓内部的情报碎片任务', 当前值: 0, 目标值: 1 },\n          })\n          .describe('当前阶段需要达成的目标列表'),\n        目标完成状态: z\n          .record(z.string(), z.boolean())\n          .prefault({\n            '0': false,\n            '1': false,\n            '2': false,\n          })\n          .describe('目标完成状态，key为索引字符串（0/1/2...），value为true表示完成'),\n        情报碎片: z\n          .record(\n            z.string(),\n            z\n              .object({\n                编号: z.string().prefault(''),\n                描述: z.string().prefault(''),\n                价值: z.string().prefault(''),\n                风险: z.string().prefault(''),\n                状态: z.enum(['未探索', '已探索', '已完成']).prefault('未探索'),\n              })\n              .prefault({\n                编号: '',\n                描述: '',\n                价值: '',\n                风险: '',\n                状态: '未探索',\n              }),\n          )\n          .prefault({})\n          .describe('已解锁的情报碎片'),\n        $meta: z\n          .object({\n            楼层: z\n              .object({\n                last_seen_message_id: z.coerce\n                  .number()\n                  .prefault(0)\n                  .describe('最近一次记录的楼层号（用于过期/清理逻辑）'),\n              })\n              .prefault({\n                last_seen_message_id: 0,\n              }),\n            情报碎片: z\n              .record(\n                z.string(),\n                z\n                  .object({\n                    created_at: z.coerce.number().prefault(0),\n                    explored_at: z.coerce.number().prefault(0),\n                    completed_at: z.coerce.number().prefault(0),\n                  })\n                  .prefault({\n                    created_at: 0,\n                    explored_at: 0,\n                    completed_at: 0,\n                  }),\n              )\n              .prefault({})\n              .describe('情报碎片的楼层时间戳（用于UI倒计时与自动清理）'),\n            阶段目标: z\n              .record(\n                z.string(),\n                z\n                  .object({\n                    completed_at: z.coerce.number().prefault(0),\n                  })\n                  .prefault({\n                    completed_at: 0,\n                  }),\n              )\n              .prefault({})\n              .describe('阶段目标的楼层时间戳（用于UI倒计时与自动清理）'),\n          })\n          .prefault({\n            楼层: {\n              last_seen_message_id: 0,\n            },\n            情报碎片: {},\n            阶段目标: {},\n          })\n          .describe('脚本/界面内部元数据（不建议在世界书中直接写入）'),\n      })\n      .prefault({\n        当前阶段: '阶段一：秩序的萌芽',\n        阶段目标: {\n          '肃清20、19、21层的敌对幸存者': { 描述: '肃清20、19、21层的敌对幸存者', 当前值: 0, 目标值: 3 },\n          庇护至少3个核心女性角色或家庭: { 描述: '庇护至少3个核心女性角色或家庭', 当前值: 0, 目标值: 3 },\n          完成一个公寓内部的情报碎片任务: { 描述: '完成一个公寓内部的情报碎片任务', 当前值: 0, 目标值: 1 },\n        },\n        目标完成状态: {\n          '0': false,\n          '1': false,\n          '2': false,\n        },\n        情报碎片: {},\n        $meta: {\n          楼层: {\n            last_seen_message_id: 0,\n          },\n          情报碎片: {},\n          阶段目标: {},\n        },\n      }),\n\n    // 主要角色\n    许茂文: 主要角色Schema,\n    相田哲也: 主要角色Schema,\n    杨幂: 主要角色Schema,\n    早川遥: 主要角色Schema,\n    早川舞: 主要角色Schema,\n    夏舒兰: 主要角色Schema,\n    中村惠子: 主要角色Schema,\n    // 爱宫心爱: 主要角色Schema,\n    // 唐嫣: 主要角色Schema,\n    '桃乐丝・泽巴哈': 主要角色Schema,\n    // 何铃: 主要角色Schema,\n    李清波: 主要角色Schema,\n    // 康绮月: 主要角色Schema,\n    // 陈雪晴: 主要角色Schema,\n    小泽花: 主要角色Schema,\n\n    临时NPC: z\n      .record(z.string(), 临时NPCSchema)\n      .prefault({})\n      .describe(\n        '存储临时NPC的状态，key为NPC姓名。临时NPC用于短期/路人角色；允许将其转正为主要角色（移至顶层并删除此处）。',\n      ),\n\n    楼层其他住户: z\n      .object({\n        言语: z.string().prefault(''),\n        行为: z.string().prefault(''),\n      })\n      .prefault({\n        言语: '',\n        行为: '',\n      }),\n  })\n  .catchall(主要角色Schema);\n\nexport type Schema = z.output<typeof Schema>;\n","import { registerMvuSchema } from 'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';\nimport { Schema } from '../../schema';\n\nconst MVU_SCHEMA_VERSION = '1.2';\n\n$(() => {\n  registerMvuSchema(Schema);\n  console.info(`[变量结构] 已加载 v${MVU_SCHEMA_VERSION}`);\n});\n"],"names":["z","normalizeRoomTag","tag","raw","String","trim","t","replace","startsWith","slice","enum","prefault","preprocess","val","s","string","args","object","relationStageSchema","describe","relationTendencySchema","coerce","number","int","transform","v","_","clamp","kind","room","m","match","floor","roomNumber","test","outdoor","area","parseRoomTag","defaultRelationStage","defaultRelationTendency","defaultImprint","Schema","record","desc","array","add","optional","remove","note","boolean","$meta","last_seen_message_id","created_at","explored_at","completed_at","catchall","$","console","info"],"ignoreList":[],"sourceRoot":""}
