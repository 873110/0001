function t(t,e){const r=Number(t);return Number.isFinite(r)?'20'===e?r<3?0:3===r?3:4===r?6:12:r<6?0:_.clamp(3*(r-5),0,12):0}function e(t){const e={};for(const[r,n]of Object.entries(t??{}))Array.isArray(n)&&(e[r]=_(n).filter(t=>'string'==typeof t&&t.trim().length>0).filter(t=>!('20'===r&&'2001'===t)).uniq().sortBy().value());return e}const r='eden.shelter_scope';function n(t){return Array.isArray(t)?_(t).filter(t=>'string'==typeof t).map(t=>t.trim()).filter(Boolean).value():[]}function o(t,e){if(e<=0)return[];const r=_(t).filter(t=>'string'==typeof t&&t.trim().length>0).map(t=>t.trim()).filter(t=>'2001'!==t).uniq().sortBy().value();return r.length<=e?r:r.slice(0,e)}$(async()=>{await waitGlobalInitialized('Mvu');eventMakeLast(Mvu.events.VARIABLE_UPDATE_ENDED,i=>{const s=_.get(i,'stat_data',{})??{},a=function(t){if(!t||'object'!=typeof t||Array.isArray(t))return null;const e=t.add??null,r=t.remove??null,o={},i={},s=null==e&&null==r&&(Object.prototype.hasOwnProperty.call(t,'20')||Object.prototype.hasOwnProperty.call(t,'19')),a=s?t:e,l=s?null:r;if(a&&'object'==typeof a&&!Array.isArray(a))for(const t of['20','19']){const e=n(a[t]);e.length&&(o[t]=e)}if(l&&'object'==typeof l&&!Array.isArray(l))for(const t of['20','19']){const e=n(l[t]);e.length&&(i[t]=e)}const c='string'==typeof t.note?String(t.note):void 0;return 0===Object.keys(o).length&&0===Object.keys(i).length?null:{add:Object.keys(o).length?o:void 0,remove:Object.keys(i).length?i:void 0,note:c}}(_.get(s,['庇护所','庇护范围变更'],null));if(!a)return;const l=function(t){const e=Number(t);return _.clamp(Number.isFinite(e)?e:1,1,10)}(_.get(s,['庇护所','庇护所等级'],1)),c=function(r,i,s){const a={...e(r)};for(const e of['20','19']){const r=t(s,e),l=Array.isArray(a[e])?a[e].slice():[],c=new Set(l);for(const t of n(i.remove?.[e]))c.delete(t);if(r>0)for(const t of n(i.add?.[e]))if('2001'!==t&&!c.has(t)){if(c.size>=r)break;c.add(t)}const f=o(Array.from(c),r);f.length>0?a[e]=f:delete a[e]}return e(a)}(function(){const t=getVariables({type:'chat'})??{},n=_.get(t,r,{});return n&&'object'==typeof n?e(n):{}}(),a,l);var f;f=c,'function'==typeof updateVariablesWith&&updateVariablesWith(t=>(_.set(t,r,e(f)),t),{type:'chat'}),_.set(s,['庇护所','当前生存庇护范围'],c),_.set(s,['庇护所','庇护范围变更'],{})})});
//# sourceMappingURL=index.js.map