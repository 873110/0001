{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src/寒冬末日/util/room.ts","src://tavern_helper_template/src/寒冬末日/脚本/房间一致性/index.ts"],"sourcesContent":["export type RoomLocation =\n  | { kind: 'entrance'; room: '临时客房A' | '临时客房B' | '玄关' | '净化/隔离区' }\n  | { kind: 'core'; room: '客厅' | '餐厅/厨房' | '主卧室' | '主浴室' }\n  | { kind: 'floor'; floor: string; roomNumber: string }\n  | { kind: 'outdoor'; area: string }\n  | { kind: 'none' };\n\ntype RoomsStatData = any;\n\nexport function normalizeRoomTag(tag: string): string {\n  const raw = String(tag ?? '').trim();\n  if (!raw) return '';\n\n  // 清理误输入的空白（兼容旧存档/手动编辑造成的断行空格）\n  const t = raw.replace(/\\s+/g, '');\n\n  // 兼容旧命名/别名\n  if (t === '核心区/餐厅厨房') return '核心区/餐厅/厨房';\n  if (\n    t === '玄关/隔离区' ||\n    t === '玄关/净化区' ||\n    t === '玄关/净化隔离区' ||\n    t === '玄关/净化/隔离区' ||\n    t === '玄关（净化/隔离区）'\n  )\n    return '玄关/净化/隔离区';\n  if (t.startsWith('室外/')) return `户外/${t.slice('室外/'.length)}`;\n  if (t === '室外') return '户外';\n\n  return t;\n}\n\nexport function parseRoomTag(tag: string): RoomLocation {\n  const t = normalizeRoomTag(tag);\n  if (!t) return { kind: 'none' };\n\n  if (t === '玄关/临时客房A') return { kind: 'entrance', room: '临时客房A' };\n  if (t === '玄关/临时客房B') return { kind: 'entrance', room: '临时客房B' };\n  if (t === '玄关/净化/隔离区') return { kind: 'entrance', room: '净化/隔离区' };\n  if (t === '玄关') return { kind: 'entrance', room: '玄关' };\n\n  if (t === '核心区/主卧室') return { kind: 'core', room: '主卧室' };\n  if (t === '核心区/主浴室') return { kind: 'core', room: '主浴室' };\n  if (t === '核心区/客厅') return { kind: 'core', room: '客厅' };\n  if (t === '核心区/餐厅/厨房') return { kind: 'core', room: '餐厅/厨房' };\n\n  const m = t.match(/^楼层(\\d+)\\/(.+)$/);\n  if (m) {\n    const floor = String(m[1] ?? '').trim();\n    const roomNumber = String(m[2] ?? '').trim();\n    // 严格限制房号为纯数字（避免“2001门外/门口”等不规范字符串进入系统）\n    if (floor && roomNumber && /^\\d{4}$/.test(roomNumber)) return { kind: 'floor', floor, roomNumber };\n  }\n\n  const outdoor = t.match(/^户外\\/(.+)$/);\n  if (outdoor) {\n    const area = String(outdoor[1] ?? '').trim();\n    if (area) return { kind: 'outdoor', area };\n    return { kind: 'outdoor', area: '' };\n  }\n  if (t === '户外') return { kind: 'outdoor', area: '' };\n\n  return { kind: 'none' };\n}\n\nexport function roomTagFromLocation(loc: RoomLocation): string {\n  if (loc.kind === 'entrance') {\n    if (loc.room === '临时客房A') return '玄关/临时客房A';\n    if (loc.room === '临时客房B') return '玄关/临时客房B';\n    if (loc.room === '净化/隔离区') return '玄关/净化/隔离区';\n    return '玄关';\n  }\n  if (loc.kind === 'core') {\n    if (loc.room === '客厅') return '核心区/客厅';\n    if (loc.room === '餐厅/厨房') return '核心区/餐厅/厨房';\n    if (loc.room === '主卧室') return '核心区/主卧室';\n    return '核心区/主浴室';\n  }\n  if (loc.kind === 'floor') return `楼层${loc.floor}/${loc.roomNumber}`;\n  if (loc.kind === 'outdoor') return loc.area ? `户外/${loc.area}` : '户外';\n  return '';\n}\n\nexport function findRoleLocation(rooms: RoomsStatData, roleName: string): RoomLocation {\n  const name = roleName ?? '';\n  if (!name) return { kind: 'none' };\n\n  const entranceA: string[] = _.get(rooms, '玄关.临时客房A入住者', []);\n  if (Array.isArray(entranceA) && entranceA.includes(name)) return { kind: 'entrance', room: '临时客房A' };\n\n  const entranceB: string[] = _.get(rooms, '玄关.临时客房B入住者', []);\n  if (Array.isArray(entranceB) && entranceB.includes(name)) return { kind: 'entrance', room: '临时客房B' };\n\n  const purify: string[] = _.get(rooms, '玄关.净化隔离区入住者', []);\n  if (Array.isArray(purify) && purify.includes(name)) return { kind: 'entrance', room: '净化/隔离区' };\n\n  const bedroom: string[] = _.get(rooms, '核心区.主卧室使用者', []);\n  if (Array.isArray(bedroom) && bedroom.includes(name)) return { kind: 'core', room: '主卧室' };\n\n  const bathroom: string[] = _.get(rooms, '核心区.主浴室使用者', []);\n  if (Array.isArray(bathroom) && bathroom.includes(name)) return { kind: 'core', room: '主浴室' };\n\n  const livingRoom: string[] = _.get(rooms, '核心区.客厅使用者', []);\n  if (Array.isArray(livingRoom) && livingRoom.includes(name)) return { kind: 'core', room: '客厅' };\n\n  const kitchen: string[] = _.get(rooms, '核心区.餐厅厨房使用者', []);\n  if (Array.isArray(kitchen) && kitchen.includes(name)) return { kind: 'core', room: '餐厅/厨房' };\n\n  const floor20: Record<string, any> = _.get(rooms, '楼层房间.楼层20房间', {});\n  if (floor20 && typeof floor20 === 'object') {\n    for (const [roomNumber, data] of Object.entries(floor20)) {\n      const residents: string[] = (data as any)?.入住者 ?? [];\n      if (Array.isArray(residents) && residents.includes(name)) return { kind: 'floor', floor: '20', roomNumber };\n    }\n  }\n\n  const floor19: Record<string, any> = _.get(rooms, '楼层房间.楼层19房间', {});\n  if (floor19 && typeof floor19 === 'object') {\n    for (const [roomNumber, data] of Object.entries(floor19)) {\n      const residents: string[] = (data as any)?.入住者 ?? [];\n      if (Array.isArray(residents) && residents.includes(name)) return { kind: 'floor', floor: '19', roomNumber };\n    }\n  }\n\n  return { kind: 'none' };\n}\n","import { findRoleLocation, parseRoomTag, normalizeRoomTag, roomTagFromLocation } from '../../util/room';\n\ntype Rooms = any;\n\nfunction readRoomDebugFlagFromChat(): boolean {\n  const vars = getVariables({ type: 'chat' }) ?? {};\n  const debug = _.get(vars, 'eden.debug', {}) ?? {};\n  return _.get(debug, 'room_logic', false) === true;\n}\n\nfunction listRoomTagsFromRooms(rooms: Rooms): string[] {\n  const tags: string[] = [\n    '玄关/临时客房A',\n    '玄关/临时客房B',\n    '核心区/客厅',\n    '核心区/餐厅/厨房',\n    '核心区/主卧室',\n    '核心区/主浴室',\n  ];\n\n  const floor20: Record<string, any> = _.get(rooms, '楼层房间.楼层20房间', {});\n  if (floor20 && typeof floor20 === 'object') {\n    for (const k of Object.keys(floor20)) {\n      const roomNumber = String(k ?? '').trim();\n      if (roomNumber) tags.push(`楼层20/${roomNumber}`);\n    }\n  }\n  const floor19: Record<string, any> = _.get(rooms, '楼层房间.楼层19房间', {});\n  if (floor19 && typeof floor19 === 'object') {\n    for (const k of Object.keys(floor19)) {\n      const roomNumber = String(k ?? '').trim();\n      if (roomNumber) tags.push(`楼层19/${roomNumber}`);\n    }\n  }\n\n  return _(tags).uniq().value();\n}\n\nfunction readRoomListByTag(rooms: Rooms, tag: string): string[] {\n  const t = normalizeRoomTag(tag);\n  if (t === '玄关/临时客房A') return _.get(rooms, '玄关.临时客房A入住者', []);\n  if (t === '玄关/临时客房B') return _.get(rooms, '玄关.临时客房B入住者', []);\n  if (t === '核心区/客厅') return _.get(rooms, '核心区.客厅使用者', []);\n  if (t === '核心区/餐厅/厨房') return _.get(rooms, '核心区.餐厅厨房使用者', []);\n  if (t === '核心区/主卧室') return _.get(rooms, '核心区.主卧室使用者', []);\n  if (t === '核心区/主浴室') return _.get(rooms, '核心区.主浴室使用者', []);\n\n  const m = t.match(/^楼层(20|19)\\/(.+)$/);\n  if (m) {\n    const floor = m[1];\n    const roomNumber = String(m[2] ?? '').trim();\n    if (!roomNumber) return [];\n    return _.get(rooms, `楼层房间.楼层${floor}房间.${roomNumber}.入住者`, []);\n  }\n\n  return [];\n}\n\nfunction isRoleLike(val: any): boolean {\n  return val && typeof val === 'object' && '健康' in val && '登场状态' in val;\n}\n\nfunction mergeRoleLike(coreRole: any, tempRole: any): any {\n  const next: any = _.cloneDeep(coreRole);\n  for (const [key, value] of Object.entries(tempRole ?? {})) {\n    const cur = next[key];\n    if (cur === undefined || cur === null) {\n      next[key] = value;\n      continue;\n    }\n    if (typeof cur === 'string' && cur.trim() === '' && typeof value === 'string' && value.trim() !== '') {\n      next[key] = value;\n      continue;\n    }\n    if (Array.isArray(cur) && cur.length === 0 && Array.isArray(value) && value.length > 0) {\n      next[key] = value.slice();\n      continue;\n    }\n  }\n  return next;\n}\n\nfunction mergeTempNpcIntoCore(stat_data: any) {\n  const temp = _.get(stat_data, '临时NPC', {});\n  if (!temp || typeof temp !== 'object' || Array.isArray(temp)) return;\n\n  for (const [name, tempRole] of Object.entries(temp)) {\n    if (typeof name !== 'string' || !name) continue;\n    if (!isRoleLike(tempRole)) continue;\n    const coreRole = _.get(stat_data, name, null);\n    if (!isRoleLike(coreRole)) continue;\n\n    const next = mergeRoleLike(coreRole, tempRole);\n    _.set(stat_data, name, next);\n    _.unset(stat_data, ['临时NPC', name]);\n  }\n}\n\nfunction listRoleNames(stat_data: any): { core: string[]; tempNpc: string[] } {\n  const reserved = new Set(['世界', '庇护所', '房间', '主线任务', '楼层其他住户', '临时NPC']);\n\n  const core: string[] = [];\n  for (const [k, v] of Object.entries(stat_data ?? {})) {\n    if (reserved.has(k)) continue;\n    if (typeof k !== 'string' || !k || k.startsWith('_')) continue;\n    if (!v || typeof v !== 'object') continue;\n    if (!('登场状态' in v) || !('健康' in v)) continue;\n    core.push(k);\n  }\n\n  const tempNpc: string[] = [];\n  const temp = _.get(stat_data, '临时NPC', {});\n  if (temp && typeof temp === 'object' && !Array.isArray(temp)) {\n    for (const [k, v] of Object.entries(temp)) {\n      if (typeof k !== 'string' || !k) continue;\n      if (!v || typeof v !== 'object') continue;\n      if (!('登场状态' in v) || !('健康' in v)) continue;\n      tempNpc.push(k);\n    }\n  }\n\n  return { core, tempNpc };\n}\n\nfunction readRoleRoomTag(stat_data: any, name: string, isTempNpc: boolean): string {\n  const path = isTempNpc ? `临时NPC.${name}.所在房间` : `${name}.所在房间`;\n  return normalizeRoomTag(_.get(stat_data, path, ''));\n}\n\nfunction writeRoleRoomTag(stat_data: any, name: string, isTempNpc: boolean, tag: string) {\n  const path = isTempNpc ? `临时NPC.${name}.所在房间` : `${name}.所在房间`;\n  _.set(stat_data, path, normalizeRoomTag(tag));\n}\n\nfunction isValidExplicitTag(tag: string): boolean {\n  if (!tag) return false;\n  const loc = parseRoomTag(tag);\n  return loc.kind !== 'none';\n}\n\nfunction resolveRoleFinalTagTagOnly(args: { oldTag: string; newTag: string }): { finalTag: string; reason: string } {\n  const oldTag = normalizeRoomTag(args.oldTag);\n  const newTag = normalizeRoomTag(args.newTag);\n\n  // 1) 单一真源：本轮显式写入且合法 → 直接采用\n  if (isValidExplicitTag(newTag)) return { finalTag: newTag, reason: 'explicit' };\n\n  // 2) 显式置空：离开/未知/外出 → 直接清空（不再依赖房间数组推断）\n  if (newTag === '') {\n    return isValidExplicitTag(oldTag) ? { finalTag: '', reason: 'explicit-none' } : { finalTag: '', reason: 'none' };\n  }\n\n  // 3) 非空但非法：视为本轮写错（例如“楼层30/3001”），保持上轮合法值以免跳房；否则清空\n  if (isValidExplicitTag(oldTag)) return { finalTag: oldTag, reason: 'invalid-keep-old' };\n  return { finalTag: '', reason: 'invalid-to-none' };\n}\n\nfunction bootstrapMissingRoleRoomTagsFromRooms(stat_data: any, debug: boolean) {\n  const rooms = _.get(stat_data, '房间', {}) ?? {};\n  const { core, tempNpc } = listRoleNames(stat_data);\n\n  const patched: Array<{ name: string; tag: string }> = [];\n  for (const name of [...core, ...tempNpc]) {\n    const isTemp = tempNpc.includes(name);\n    const curTag = readRoleRoomTag(stat_data, name, isTemp);\n    if (curTag) continue;\n\n    const loc = findRoleLocation(rooms, name);\n    const tag = roomTagFromLocation(loc);\n    if (!tag) continue;\n\n    writeRoleRoomTag(stat_data, name, isTemp, tag);\n    patched.push({ name, tag });\n  }\n\n  if (debug && patched.length > 0) {\n    console.log('[RoomLogic] bootstrapped missing role tags from rooms:', patched);\n  }\n}\n\nfunction keepUnknownNames(list: any, known: Set<string>): string[] {\n  if (!Array.isArray(list)) return [];\n  return _(list)\n    .filter((x: any) => typeof x === 'string')\n    .map((x: string) => x.trim())\n    .filter((x: string) => x.length > 0 && !known.has(x))\n    .value();\n}\n\nfunction ensureFloorRoomSlot(nextRooms: Rooms, floor: '20' | '19', roomNumber: string) {\n  const path = `楼层房间.楼层${floor}房间.${roomNumber}`;\n  const cur = _.get(nextRooms, path, null);\n  if (!cur || typeof cur !== 'object') _.set(nextRooms, path, { 入住者: [] });\n  const residents = _.get(nextRooms, `${path}.入住者`, null);\n  if (!Array.isArray(residents)) _.set(nextRooms, `${path}.入住者`, []);\n}\n\nfunction writeRoomListByTag(nextRooms: Rooms, tag: string, list: string[]) {\n  const t = normalizeRoomTag(tag);\n  if (t === '玄关/临时客房A') return void _.set(nextRooms, '玄关.临时客房A入住者', list);\n  if (t === '玄关/临时客房B') return void _.set(nextRooms, '玄关.临时客房B入住者', list);\n  if (t === '核心区/客厅') return void _.set(nextRooms, '核心区.客厅使用者', list);\n  if (t === '核心区/餐厅/厨房') return void _.set(nextRooms, '核心区.餐厅厨房使用者', list);\n  if (t === '核心区/主卧室') return void _.set(nextRooms, '核心区.主卧室使用者', list);\n  if (t === '核心区/主浴室') return void _.set(nextRooms, '核心区.主浴室使用者', list);\n\n  const m = t.match(/^楼层(20|19)\\/(.+)$/);\n  if (!m) return;\n  const floor = m[1] as '20' | '19';\n  const roomNumber = String(m[2] ?? '').trim();\n  if (!roomNumber) return;\n  ensureFloorRoomSlot(nextRooms, floor, roomNumber);\n  _.set(nextRooms, `楼层房间.楼层${floor}房间.${roomNumber}.入住者`, list);\n}\n\nfunction applyRoomConsistency(stat_data: any, old_stat_data: any, debug: boolean) {\n  // 若同名角色同时存在于顶层与临时NPC，自动合并并移除临时NPC\n  mergeTempNpcIntoCore(stat_data);\n\n  const rooms = _.get(stat_data, '房间', {}) ?? {};\n  const oldRooms = _.get(old_stat_data, '房间', {}) ?? {};\n\n  // 兼容旧存档：若 initvar/旧聊天只维护了房间数组但没写“所在房间”，先把缺失标签补齐。\n  // 补齐后，后续逻辑以“所在房间”为单一真源，`房间/**` 只作为派生输出。\n  bootstrapMissingRoleRoomTagsFromRooms(stat_data, debug);\n\n  const { core, tempNpc } = listRoleNames(stat_data);\n  const knownNames = new Set<string>([...core, ...tempNpc]);\n\n  const allTags = _([...listRoomTagsFromRooms(oldRooms), ...listRoomTagsFromRooms(rooms)])\n    .uniq()\n    .value();\n\n  const finalTagByName = new Map<string, string>();\n  const finalReasonByName = new Map<string, string>();\n  const oldTagByName = new Map<string, string>();\n  const newTagByName = new Map<string, string>();\n\n  for (const name of [...core, ...tempNpc]) {\n    const isTemp = tempNpc.includes(name);\n    const oldTag = readRoleRoomTag(old_stat_data, name, isTemp);\n    const newTag = readRoleRoomTag(stat_data, name, isTemp);\n    oldTagByName.set(name, oldTag);\n    newTagByName.set(name, newTag);\n\n    const resolved = resolveRoleFinalTagTagOnly({ oldTag, newTag });\n    finalTagByName.set(name, resolved.finalTag);\n    finalReasonByName.set(name, resolved.reason);\n  }\n\n  // 1) 写回角色“所在房间”，作为之后轮次的真源\n  for (const name of [...core, ...tempNpc]) {\n    const isTemp = tempNpc.includes(name);\n    const tag = finalTagByName.get(name) ?? '';\n    writeRoleRoomTag(stat_data, name, isTemp, tag);\n  }\n\n  // 2) 重建房间数组：先保留 unknown（如 {{user}}），再按所在房间分配 known\n  const nextRooms = _.cloneDeep(rooms ?? {});\n\n  const unknownByTag: Record<string, string[]> = {};\n  const priorKnownOrderByTag: Record<string, string[]> = {};\n  for (const tag of allTags) {\n    // 房间数组属于派生数据：unknown（如 {{user}}）以“本轮现值”为准，避免删除/迁移时被旧值反向复活。\n    const raw = readRoomListByTag(rooms, tag);\n    unknownByTag[tag] = keepUnknownNames(raw, knownNames);\n    priorKnownOrderByTag[tag] = Array.isArray(raw) ? raw.filter(x => typeof x === 'string' && knownNames.has(x)) : [];\n\n    // 但对宏占位符做“温和兜底”：如果上一轮存在宏（如 {{user}}）而本轮被误删，则保留它。\n    const oldRaw = readRoomListByTag(oldRooms, tag);\n    const stickyMacros = keepUnknownNames(oldRaw, knownNames).filter(x => x === '{{user}}' || /^\\{\\{.+\\}\\}$/.test(x));\n    if (stickyMacros.length > 0) {\n      const merged = _(unknownByTag[tag]).concat(stickyMacros).uniq().value();\n      unknownByTag[tag] = merged;\n    }\n  }\n\n  const assignedByTag: Record<string, string[]> = {};\n  for (const [name, tag] of finalTagByName.entries()) {\n    if (!tag) continue;\n    // UI 的房间数组没有“玄关”这个列表，所以“玄关”作为逻辑位置时，默认派生到临时客房A用于显示。\n    const physicalTag = tag === '玄关' ? '玄关/临时客房A' : tag;\n    if (!assignedByTag[physicalTag]) assignedByTag[physicalTag] = [];\n    assignedByTag[physicalTag].push(name);\n  }\n\n  const writeTags = _([...allTags, ...Object.keys(assignedByTag)])\n    .uniq()\n    .value();\n  for (const tag of writeTags) {\n    const assigned = assignedByTag[tag] ?? [];\n    const prior = priorKnownOrderByTag[tag] ?? [];\n    const orderedInPrior = prior.filter(n => assigned.includes(n));\n    const rest = assigned.filter(n => !orderedInPrior.includes(n)).sort();\n    const list = [...(unknownByTag[tag] ?? []), ...orderedInPrior, ...rest];\n    writeRoomListByTag(nextRooms, tag, _(list).uniq().value());\n  }\n\n  _.set(stat_data, '房间', nextRooms);\n\n  if (debug) {\n    const explicitNone = [...finalReasonByName.entries()]\n      .filter(([, reason]) => reason === 'explicit-none')\n      .map(([name]) => ({\n        name,\n        oldTag: oldTagByName.get(name) ?? '',\n        newTag: newTagByName.get(name) ?? '',\n        finalTag: finalTagByName.get(name) ?? '',\n      }));\n    if (explicitNone.length > 0) {\n      console.log('[RoomLogic] explicit-none applied (role left to unknown):', explicitNone);\n    }\n\n    const dup: Array<{ name: string; tags: string[] }> = [];\n    for (const name of [...core, ...tempNpc]) {\n      const tags = writeTags.filter(t => (readRoomListByTag(nextRooms, t) ?? []).includes(name));\n      if (tags.length > 1) dup.push({ name, tags });\n    }\n    if (dup.length > 0) console.log('[RoomLogic] still duplicated after reconcile:', dup);\n\n    const reasons = [...finalReasonByName.entries()].reduce<Record<string, number>>((acc, [, r]) => {\n      acc[r] = (acc[r] ?? 0) + 1;\n      return acc;\n    }, {});\n    console.log('[RoomLogic] reconcile summary:', reasons);\n  }\n}\n\n$(async () => {\n  await waitGlobalInitialized('Mvu');\n\n  const listener = (new_variables: any, old_variables: any) => {\n    const stat_data = _.get(new_variables, 'stat_data', {}) ?? {};\n    const old_stat_data = _.get(old_variables, 'stat_data', {}) ?? {};\n    const debug = readRoomDebugFlagFromChat();\n    applyRoomConsistency(stat_data, old_stat_data, debug);\n  };\n\n  // 让房间一致性优先执行：保证其他脚本读取到的是已纠偏后的房间结构\n  eventMakeFirst(Mvu.events.VARIABLE_UPDATE_ENDED, listener);\n});\n"],"names":["normalizeRoomTag","tag","raw","String","trim","t","replace","startsWith","slice","roomTagFromLocation","loc","kind","room","floor","roomNumber","area","findRoleLocation","rooms","roleName","name","entranceA","_","get","Array","isArray","includes","entranceB","purify","bedroom","bathroom","livingRoom","kitchen","floor20","data","Object","entries","residents","floor19","listRoomTagsFromRooms","tags","k","keys","push","uniq","value","readRoomListByTag","m","match","isRoleLike","val","mergeRoleLike","coreRole","tempRole","next","cloneDeep","key","cur","length","listRoleNames","stat_data","reserved","Set","core","v","has","tempNpc","temp","readRoleRoomTag","isTempNpc","path","writeRoleRoomTag","set","isValidExplicitTag","test","outdoor","parseRoomTag","resolveRoleFinalTagTagOnly","args","oldTag","newTag","finalTag","reason","keepUnknownNames","list","known","filter","x","map","writeRoomListByTag","nextRooms","ensureFloorRoomSlot","applyRoomConsistency","old_stat_data","debug","unset","mergeTempNpcIntoCore","oldRooms","patched","isTemp","console","log","bootstrapMissingRoleRoomTagsFromRooms","knownNames","allTags","finalTagByName","Map","finalReasonByName","oldTagByName","newTagByName","resolved","unknownByTag","priorKnownOrderByTag","stickyMacros","merged","concat","assignedByTag","physicalTag","writeTags","assigned","orderedInPrior","n","rest","sort","explicitNone","dup","reasons","reduce","acc","r","$","async","waitGlobalInitialized","eventMakeFirst","Mvu","events","VARIABLE_UPDATE_ENDED","new_variables","old_variables","vars","getVariables","type","readRoomDebugFlagFromChat"],"ignoreList":[],"sourceRoot":""}